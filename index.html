<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GovernUp Dashboard - Phase 1</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- React & ReactDOM -->
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>

    <!-- React Router DOM (includes Remix Router) -->
    <script crossorigin src="https://unpkg.com/@remix-run/router@1.0.3/dist/router.umd.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-router@6.4.3/dist/umd/react-router.production.min.js"></script>
    <script crossorigin
        src="https://unpkg.com/react-router-dom@6.4.3/dist/umd/react-router-dom.production.min.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone@7.23.3/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <link rel="stylesheet" href="styles.css?v=639079047528290049">
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useContext, createContext, useMemo } = React;
        const { HashRouter, Routes, Route, Link, useLocation, useNavigate } = window.ReactRouterDOM;
        // --- SVGs ---
        const IconSvg = ({ children, size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                {children}
            </svg>
        );
        const Target = ({ size }) => <IconSvg size={size}><circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="6" /><circle cx="12" cy="12" r="2" /></IconSvg>;
        const Settings = ({ size }) => <IconSvg size={size}><circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" /></IconSvg>;
        const Shield = ({ size }) => <IconSvg size={size}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /></IconSvg>;
        const CloudLightning = ({ size }) => <IconSvg size={size}><path d="M19 16.9A5 5 0 0 0 18 7h-1.26a8 8 0 1 0-11.62 9" /><polyline points="13 11 9 17 15 17 11 23" /></IconSvg>;
        const MapIcon = ({ size }) => <IconSvg size={size}><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21" /><line x1="9" y1="3" x2="9" y2="18" /><line x1="15" y1="6" x2="15" y2="21" /></IconSvg>;
        const ClipboardList = ({ size }) => <IconSvg size={size}><rect x="8" y="2" width="8" height="4" rx="1" ry="1" /><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" /><path d="M12 11h4" /><path d="M12 16h4" /><path d="M8 11h.01" /><path d="M8 16h.01" /></IconSvg>;
        const BarChart2 = ({ size }) => <IconSvg size={size}><line x1="18" y1="20" x2="18" y2="10" /><line x1="12" y1="20" x2="12" y2="4" /><line x1="6" y1="20" x2="6" y2="14" /></IconSvg>;
        const Layers = ({ size }) => <IconSvg size={size}><polygon points="12 2 2 7 12 12 22 7 12 2" /><polyline points="2 12 12 17 22 12" /><polyline points="2 17 12 22 22 17" /></IconSvg>;
        const ChevronDown = ({ size }) => <IconSvg size={size}><polyline points="6 9 12 15 18 9" /></IconSvg>;
        const ChevronRight = ({ size }) => <IconSvg size={size}><polyline points="9 18 15 12 9 6" /></IconSvg>;
        const X = ({ size }) => <IconSvg size={size}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></IconSvg>;
        const LayoutDashboard = ({ size }) => <IconSvg size={size}><rect x="3" y="3" width="7" height="9" /><rect x="14" y="3" width="7" height="5" /><rect x="14" y="12" width="7" height="9" /><rect x="3" y="16" width="7" height="5" /></IconSvg>;
        const Activity = ({ size }) => <IconSvg size={size}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12" /></IconSvg>;
        const Users = ({ size }) => <IconSvg size={size}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M23 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></IconSvg>;
        const MenuIcon = ({ size }) => <IconSvg size={size}><line x1="3" y1="12" x2="21" y2="12" /><line x1="3" y1="6" x2="21" y2="6" /><line x1="3" y1="18" x2="21" y2="18" /></IconSvg>;

        // -----------------------------------------------------------------------------
        // Global Context / State Management
        // -----------------------------------------------------------------------------
        const AppContext = createContext();

        const AppProvider = ({ children }) => {
            const [activePage, setActivePage] = useState("Dashboard Home");
            const [activePillar, setActivePillar] = useState(null);
            const [drawerOpen, setDrawerOpen] = useState(false);
            const [activeGlobalApp, setActiveGlobalApp] = useState(null);
            const [globalAppContext, setGlobalAppContext] = useState({});
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

            const openApp = (appId, context = {}) => {
                setActiveGlobalApp(appId);
                setGlobalAppContext(context);
                setDrawerOpen(true);
            };

            useEffect(() => {
                const handleMessage = (event) => {
                    if (event.data && event.data.type === 'OPEN_APP') {
                        openApp(event.data.appId, event.data.context);
                    }
                };
                window.addEventListener('message', handleMessage);
                return () => window.removeEventListener('message', handleMessage);
            }, []);

            const closeDrawer = () => {
                setDrawerOpen(false);
                setTimeout(() => {
                    setActiveGlobalApp(null);
                    setGlobalAppContext({});
                }, 400); // Wait for transition
            };

            const value = {
                activePage, setActivePage,
                activePillar, setActivePillar,
                drawerOpen, openApp, closeDrawer, activeGlobalApp, globalAppContext,
                mobileMenuOpen, setMobileMenuOpen
            };

            return <AppContext.Provider value={value}>{children}</AppContext.Provider>;
        };

        // -----------------------------------------------------------------------------
        // Data Structure
        // -----------------------------------------------------------------------------
        const NAVIGATION = {
            Pillars: [
                {
                    id: "A",
                    title: "A Purpose & Mission",
                    icon: <Target size={20} />,
                    items: [
                        { id: "A1", path: "/a1", label: "A1 Service Delivery" },
                        { id: "A2", path: "/a2", label: "A2 Inputs" },
                        { id: "A3", path: "/a3", label: "A3 Outputs" },
                        { id: "A4", path: "/a4", label: "A4 Outcomes" },
                        { id: "A5", path: "/a5", label: "A5 Impact" }
                    ]
                },
                {
                    id: "B",
                    title: "B Operations",
                    icon: <Settings size={20} />,
                    items: [
                        { id: "B1", path: "/b1", label: "B1 Financial Sustainability", description: "Manage financial sustainability. Track core funding, project grants, budgets, and financial reporting compliance to ensure long-term viability." },
                        { id: "B2", path: "/b2", label: "B2 Fund Raising", description: "Cultivate donor relationships and manage fundraising campaigns. Track donor retention, campaign ROI, and adherence to fundraising regulations." },
                        { id: "B3", path: "/b3", label: "B3 Volunteer Management", description: "Attract, retain, and develop volunteers. Manage recruitment, training, scheduling, and volunteer impact measurement." },
                        { id: "B4", path: "/b4", label: "B4 Marketing & Communications", description: "Amplify your charity's voice. Manage public relations, social media, campaign reach, and brand reputation to drive awareness and engagement." },
                        { id: "B5", path: "/b5", label: "B5 Human Resource", description: "Build a strong team. Manage staff recruitment, retention, professional development, well-being, and compliance with employment laws." }
                    ]
                },
                {
                    id: "C",
                    title: "C Governance",
                    icon: <Shield size={20} />,
                    items: [
                        { id: "C1", path: "/c1", label: "C1 Governance Evaluation Checklist (GEC)", description: "Prepare for and manage the mandatory annual GEC submission. Track compliance status across key governance principles." },
                        { id: "C2", path: "/c2", label: "C2 Risk Management", description: "Identify, assess, and mitigate risks. Build resilience by tracking operational, financial, and reputational risks to protect the charity's mission." },
                        { id: "C3", path: "/c3", label: "C3 Standard Operating Procedures", description: "Standardise internal processes. Maintain a central repository of operational guidelines to ensure consistency and mitigate risks." },
                        { id: "C4", path: "/c4", label: "C4 Constitution", description: "Manage the foundation of your charity. Track updates to the governing instrument and ensure all activities align with the defined charitable objects." },
                        { id: "C5", path: "/c5", label: "C5 Terms of Reference", description: "Define committee scopes. Manage the roles, responsibilities, and authority limits of sub-committees supporting the Board." },
                        { id: "C6", path: "/c6", label: "C6 Strategic Plans", description: "Chart the long-term course. Document multi-year strategic goals, align resources, and track progress against strategic milestones." }
                    ]
                }
            ],
            GlobalApps: [
                { id: "D1", label: "D1 QUESTION STORMER" },
                { id: "D2", label: "D2 WAYFINDER" },
                { id: "D3", label: "D3 SURVEY" },
                { id: "D4", label: "D4 ANALYZER" }
            ]
        };

        // Helper Icon Mapper
        const getIconForPath = (path) => {
            if (path.startsWith('/a')) return <Activity size={32} />;
            if (path.startsWith('/b')) return <Users size={32} />;
            if (path.startsWith('/c')) return <Shield size={32} />;
            return <LayoutDashboard size={32} />;
        };

        // -----------------------------------------------------------------------------
        // Components
        // -----------------------------------------------------------------------------

        const Sidebar = () => {
            const { activePillar, setActivePillar, setMobileMenuOpen } = useContext(AppContext);
            const location = useLocation();

            const toggleAccordion = (id) => {
                setActivePillar(activePillar === id ? null : id);
            };

            const handleNavigate = () => {
                if (window.innerWidth <= 768) {
                    setMobileMenuOpen(false);
                }
            };

            // Auto-expand pillar based on current route
            useEffect(() => {
                NAVIGATION.Pillars.forEach(pillar => {
                    const match = pillar.items.find(item => item.path === location.pathname);
                    if (match) {
                        setActivePillar(pillar.id);
                    }
                });
            }, [location.pathname]);

            return (
                <aside className="sidebar">
                    <Link to="/" style={{ textDecoration: 'none', color: 'inherit', display: 'block' }} onClick={handleNavigate}>
                        <div className="brand">
                            <div className="brand-icon"><Layers size={24} /></div>
                            GovernUp
                        </div>
                    </Link>

                    <div className="nav-scroll">
                        {NAVIGATION.Pillars.map((pillar) => {
                            const isOpen = activePillar === pillar.id;
                            return (
                                <div key={pillar.id} className="nav-pillar">
                                    <div
                                        className={`pillar-header ${isOpen ? 'active' : ''}`}
                                        onClick={() => toggleAccordion(pillar.id)}
                                    >
                                        <div className="pillar-title">
                                            <i>{pillar.icon}</i>
                                            {pillar.title}
                                        </div>
                                        {isOpen ? <ChevronDown size={16} /> : <ChevronRight size={16} />}
                                    </div>

                                    <div className={`nav-items ${isOpen ? 'open' : ''}`}>
                                        {pillar.items.map(item => {
                                            const isActive = location.pathname === item.path;
                                            return (
                                                <Link
                                                    key={item.id}
                                                    to={item.path}
                                                    className={`nav-item ${isActive ? 'active' : ''}`}
                                                    onClick={handleNavigate}
                                                >
                                                    {item.label}
                                                </Link>
                                            );
                                        })}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </aside>
            );
        };

        const TopBar = () => {
            const { activePage, openApp, setMobileMenuOpen } = useContext(AppContext);
            const location = useLocation();

            // Find current pillar based on route
            let currentPillarTitle = "";
            NAVIGATION.Pillars.forEach(pillar => {
                const match = pillar.items.find(item => item.path === location.pathname);
                if (match) currentPillarTitle = pillar.title;
            });

            return (
                <header className="top-bar">
                    <div style={{ display: "flex", alignItems: "center", gap: "1rem" }}>
                        <button className="mobile-menu-btn" onClick={() => setMobileMenuOpen(prev => !prev)}>
                            <MenuIcon size={24} />
                        </button>

                        <div className="breadcrumbs" style={{
                            display: "flex", flexWrap: "wrap", alignItems: "center", gap: "0.5rem",
                            fontSize: "0.80rem", color: "var(--text-muted)", fontFamily: "var(--font-mono)",
                            textTransform: "uppercase", letterSpacing: "0.05em"
                        }}>
                            <Link to="/" style={{ color: "var(--text-muted)", textDecoration: "none", display: "flex", alignItems: "center", gap: "0.25rem", transition: "color 0.2s" }} onMouseOver={(e) => e.currentTarget.style.color = "var(--text-main)"} onMouseOut={(e) => e.currentTarget.style.color = "var(--text-muted)"}>
                                <Layers size={14} /> PORTAL
                            </Link>

                            {currentPillarTitle && (
                                <>
                                    <ChevronRight size={14} style={{ color: "rgba(255,255,255,0.2)" }} />
                                    <span style={{ color: "var(--text-main)" }}>{currentPillarTitle}</span>
                                </>
                            )}

                            {activePage && activePage !== "Global Overview" && (
                                <>
                                    <ChevronRight size={14} style={{ color: "rgba(255,255,255,0.2)" }} />
                                    <span style={{ color: "var(--accent-cyan)", fontWeight: 600 }}>{activePage}</span>
                                </>
                            )}

                            {activePage === "Global Overview" && (
                                <>
                                    <ChevronRight size={14} style={{ color: "rgba(255,255,255,0.2)" }} />
                                    <span style={{ color: "var(--text-main)", fontWeight: 600 }}>OVERVIEW</span>
                                </>
                            )}
                        </div>
                    </div>

                    <div className="global-dock">
                        {NAVIGATION.GlobalApps.map(app => (
                            <button
                                key={app.id}
                                className="dock-btn text-dock-btn"
                                onClick={() => openApp(app.id)}
                            >
                                {app.label}
                            </button>
                        ))}
                    </div>
                </header>
            );
        };

        const D3Survey = () => {
            const { activePage } = useContext(AppContext);

            // Extract areas from NAVIGATION
            const allAreas = NAVIGATION.Pillars.flatMap(p => p.items);

            // Try to match activePage to an area
            const initialMatch = allAreas.find(a => a.label === activePage);

            const [selectedArea, setSelectedArea] = useState(initialMatch ? initialMatch.id : "A1");
            const [questions, setQuestions] = useState([]);
            const [customQuestion, setCustomQuestion] = useState("");

            // Re-generate auto questions when area changes
            useEffect(() => {
                const areaObj = allAreas.find(a => a.id === selectedArea);
                if (areaObj) {
                    const areaLabel = areaObj.label.replace(/^[A-C][1-6]\s/, '');
                    setQuestions([
                        `On a scale of 1-10, how effective is our ${areaLabel}?`,
                        `What are the key bottlenecks in our current ${areaLabel}?`,
                        `How satisfied are our stakeholders with our ${areaLabel}?`
                    ]);
                }
            }, [selectedArea]);

            const handleAddQuestion = (e) => {
                e.preventDefault();
                if (customQuestion.trim() && questions.length < 6) {
                    setQuestions([...questions, customQuestion.trim()]);
                    setCustomQuestion("");
                }
            };

            const removeCustomQuestion = (index) => {
                if (index >= 3) {
                    setQuestions(questions.filter((_, i) => i !== index));
                }
            };

            const sendWhatsApp = () => {
                const areaObj = allAreas.find(a => a.id === selectedArea);
                const areaLabel = areaObj ? areaObj.label : selectedArea;

                let message = `*Charity Portal Survey: ${areaLabel}*\n\nPlease share your thoughts on the following questions:\n\n`;
                questions.forEach((q, i) => {
                    message += `${i + 1}. ${q}\n`;
                });
                message += `\nReply with your answers!`;

                const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
                window.open(url, '_blank');
            };

            return (
                <div className="analyzer-container fade-in">
                    <p style={{ color: "var(--text-muted)", marginBottom: "1.5rem" }}>
                        Generate a quick 6-question pulse survey for any operational area.
                    </p>

                    <div style={{ marginBottom: "1.5rem" }}>
                        <label style={{ display: "block", marginBottom: "0.5rem", color: "var(--accent-cyan)", fontSize: "0.85rem", textTransform: "uppercase", letterSpacing: "0.05em" }}>
                            Select Survey Target Area
                        </label>
                        <select
                            value={selectedArea}
                            onChange={(e) => setSelectedArea(e.target.value)}
                            style={{
                                width: "100%", padding: "12px", borderRadius: "8px",
                                background: "rgba(255, 255, 255, 0.03)", border: "1px solid var(--border-color)",
                                color: "white", outline: "none", fontSize: "1rem"
                            }}
                        >
                            {allAreas.map(area => (
                                <option key={area.id} value={area.id} style={{ color: "black" }}>{area.label}</option>
                            ))}
                        </select>
                    </div>

                    <div className="insight-box" style={{ marginBottom: "1.5rem", background: "rgba(6, 182, 212, 0.1)", borderLeftColor: "var(--accent-cyan)" }}>
                        <strong>{questions.length}/6 Questions Loaded</strong><br />
                        <span style={{ fontSize: "0.85rem", color: "var(--text-muted)" }}>3 auto-generated based on the domain. Add up to 3 custom questions.</span>
                    </div>

                    <ul className="suggested-questions" style={{ marginBottom: "1.5rem" }}>
                        {questions.map((q, i) => (
                            <li key={i} style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", gap: "1rem" }}>
                                <div style={{ display: "flex", gap: "0.5rem", width: "100%" }}>
                                    <strong style={{ color: i < 3 ? "var(--accent-cyan)" : "var(--accent-emerald)", whiteSpace: "nowrap", paddingTop: "0.4rem" }}>
                                        Q{i + 1}:
                                    </strong>
                                    <textarea
                                        value={q}
                                        onChange={(e) => {
                                            const newQs = [...questions];
                                            newQs[i] = e.target.value;
                                            setQuestions(newQs);
                                        }}
                                        style={{
                                            flex: 1,
                                            background: "rgba(0,0,0,0.2)",
                                            border: "1px solid rgba(255,255,255,0.05)",
                                            borderRadius: "6px",
                                            padding: "0.4rem 0.6rem",
                                            color: "var(--text-main)",
                                            outline: "none",
                                            fontFamily: "inherit",
                                            fontSize: "0.95rem",
                                            resize: "vertical",
                                            minHeight: "44px",
                                            lineHeight: "1.4",
                                            transition: "border-color 0.2s"
                                        }}
                                        onFocus={(e) => e.target.style.borderColor = "var(--accent-cyan)"}
                                        onBlur={(e) => e.target.style.borderColor = "rgba(255,255,255,0.05)"}
                                    />
                                </div>
                                {i >= 3 && (
                                    <button
                                        onClick={() => removeCustomQuestion(i)}
                                        style={{ background: "rgba(244, 63, 94, 0.1)", border: "1px solid rgba(244, 63, 94, 0.3)", color: "#f43f5e", cursor: "pointer", padding: "4px", borderRadius: "4px", marginTop: "0.4rem" }}
                                        title="Remove custom question"
                                    >
                                        <X size={14} />
                                    </button>
                                )}
                            </li>
                        ))}
                    </ul>

                    {questions.length < 6 && (
                        <form onSubmit={handleAddQuestion} style={{ display: "flex", gap: "0.5rem", marginBottom: "1.5rem" }}>
                            <input
                                type="text"
                                value={customQuestion}
                                onChange={(e) => setCustomQuestion(e.target.value)}
                                placeholder="Add custom query..."
                                style={{ flex: 1, padding: "10px", borderRadius: "8px", background: "rgba(0,0,0,0.3)", border: "1px solid var(--border-color)", color: "white", outline: "none" }}
                            />
                            <button
                                type="submit"
                                className="dock-btn text-dock-btn"
                                disabled={!customQuestion.trim()}
                                style={{ opacity: customQuestion.trim() ? 1 : 0.5, borderColor: "var(--accent-emerald)" }}
                            >
                                Add
                            </button>
                        </form>
                    )}

                    <button
                        onClick={sendWhatsApp}
                        style={{
                            width: "100%", padding: "14px", borderRadius: "12px",
                            background: "linear-gradient(135deg, #25D366, #128C7E)",
                            color: "white", border: "none", fontSize: "1rem", fontWeight: "600",
                            cursor: "pointer", display: "flex", justifyContent: "center", alignItems: "center", gap: "0.5rem",
                            boxShadow: "0 4px 15px rgba(37, 211, 102, 0.3)"
                        }}
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" /></svg>
                        Share via WhatsApp
                    </button>
                </div>
            );
        };

        // Context-Aware Sliding Drawer Output
        const D4Analyzer = () => {
            const { openApp } = useContext(AppContext);
            const [selectedNodes, setSelectedNodes] = useState([]);

            const allNodes = [
                { code: "A1", label: "Service Delivery" },
                { code: "A2", label: "Inputs" },
                { code: "A3", label: "Outputs" },
                { code: "A4", label: "Outcomes" },
                { code: "A5", label: "Impact" },
                { code: "B1", label: "Financial Sustainability" },
                { code: "B2", label: "Fund Raising" },
                { code: "B3", label: "Volunteer Mgt" },
                { code: "B4", label: "Marketing & Comms" },
                { code: "B5", label: "HR" },
                { code: "C1", label: "GEC" },
                { code: "C2", label: "Risk Management" },
                { code: "C3", label: "SOPs" },
                { code: "C4", label: "Constitution" },
                { code: "C5", label: "Terms of Ref" },
                { code: "C6", label: "Strategic Plans" }
            ];

            const toggleNode = (code) => {
                setSelectedNodes(prev =>
                    prev.includes(code) ? prev.filter(p => p !== code) : [...prev, code]
                );
            };

            // Evaluate Insight
            let insight = "";
            let questions = [];

            const hasA2 = selectedNodes.includes("A2");
            const hasA5 = selectedNodes.includes("A5");
            const hasB1 = selectedNodes.includes("B1");

            if (hasA2 && hasA5 && hasB1) {
                insight = "It appears that you are interested in whether the TOC (Theory of Change) is aligned with the impact and whether money was well spent.";
                questions = [
                    "How do our current inputs directly translate into our measured outcomes?",
                    "Are there gaps between our financial spending and our perceived impact?",
                    "What metrics should we establish to bridge the connection between cost and mission effectiveness?"
                ];
            } else if (selectedNodes.length > 0) {
                const names = selectedNodes.map(code => {
                    const node = allNodes.find(n => n.code === code);
                    return node ? node.label : code;
                });

                let namesStr = "";
                if (names.length === 1) namesStr = names[0];
                else if (names.length === 2) namesStr = `${names[0]} and ${names[1]}`;
                else namesStr = names.slice(0, -1).join(', ') + ', and ' + names[names.length - 1];

                insight = `It appears you are exploring the intersection of ${namesStr}. Consider how these specific components interact and influence each other.`;
                questions = [
                    `How does our approach to ${names[0]} directly impact our goals in the other selected areas?`,
                    `Are there systemic bottlenecks or misalignments between these specific pillars?`,
                    `If we significantly improved ${names[0]}, what secondary effects would we see across the related modules?`
                ];
            }

            return (
                <div className="analyzer-container fade-in">
                    <p style={{ color: "var(--text-muted)", marginBottom: "1.5rem", lineHeight: 1.6 }}>
                        Select a combination of nodes below. The portal will respond with prompts for you to consider, letting the paths reveal the destination.
                    </p>
                    <div className="nodes-grid">
                        {allNodes.map(node => (
                            <button
                                key={node.code}
                                className={`node-pill ${selectedNodes.includes(node.code) ? 'active' : ''}`}
                                onClick={() => toggleNode(node.code)}
                            >
                                <span className="node-code">{node.code}</span>
                                {node.label}
                            </button>
                        ))}
                    </div>

                    {selectedNodes.length > 0 && (
                        <div className="analyzer-result fade-in" style={{ marginTop: "3rem" }}>
                            <h4 style={{ color: "var(--accent-purple)", marginBottom: "0.75rem", fontFamily: "var(--font-mono)", textTransform: "uppercase", fontSize: "0.85rem", letterSpacing: "0.05em" }}>Analysis Synthesis</h4>
                            <div className="insight-box">
                                {insight}
                            </div>

                            <h4 style={{ color: "var(--text-main)", marginBottom: "1rem", marginTop: "2.5rem", fontWeight: 600, fontSize: "1.05rem" }}>
                                Would you like to question storm any of the following suggested questions?
                            </h4>
                            <ul className="suggested-questions">
                                {questions.map((q, idx) => (
                                    <li key={idx}>
                                        <div style={{ color: "var(--text-main)", fontWeight: 500 }}>"{q}"</div>
                                        <button className="storm-btn" onClick={() => openApp('D1', { question: q })}>
                                            <CloudLightning size={16} /> Storm This
                                        </button>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    )}
                </div>
            );
        };

        const D1QuestionStormer = () => {
            const { activePage, globalAppContext } = useContext(AppContext);
            const [inputValue, setInputValue] = useState("");
            const [storms, setStorms] = useState([]);

            // Generate initial prompt based on usage context or passthrough
            const defaultPrompt = (globalAppContext && globalAppContext.question)
                ? globalAppContext.question
                : `How does our ${activePage} framework align with our core impact goals?`;

            useEffect(() => {
                setInputValue(defaultPrompt);
            }, [defaultPrompt]);

            const handleStorm = (qToStorm) => {
                const query = typeof qToStorm === 'string' ? qToStorm : inputValue;
                if (!query.trim()) return;

                const followUpPrompts = [
                    "What metrics would immediately prove our current hypothesis wrong?",
                    "How might a newly founded organization solve this entirely differently?",
                    "Which stakeholder group is completely missing from this equation?",
                    "If we had only 10% of our budget, how would we maintain this impact?",
                    "What is the most risky assumption embedded in our approach here?"
                ];
                const randomPrompt = followUpPrompts[Math.floor(Math.random() * followUpPrompts.length)];

                let matchedNode = "c1";
                const qMatch = query.match(/\b([a-c][1-6])\b/i);
                const pageMatch = activePage.match(/^([a-c][1-6])/i);

                if (qMatch) {
                    matchedNode = qMatch[1].toLowerCase();
                } else if (pageMatch) {
                    matchedNode = pageMatch[1].toLowerCase();
                } else {
                    const codes = ["a1", "a2", "a3", "a4", "a5", "b1", "b2", "b3", "b4", "b5", "c1", "c2", "c3", "c4", "c5", "c6"];
                    matchedNode = codes[Math.floor(Math.random() * codes.length)];
                }

                const newStorm = {
                    question: query,
                    answer: `Insight: Addressing "${query}" often reveals new strategic pathways. Try exploring the ${matchedNode.toUpperCase()} module for structural answers.`,
                    link: `#/${matchedNode}`, // Dynamic link
                    timestamp: new Date().toLocaleTimeString(),
                    suggestedQuestion: randomPrompt
                };

                setStorms([newStorm, ...storms]);
                if (typeof qToStorm !== 'string') setInputValue("");
            };

            return (
                <div className="analyzer-container fade-in">
                    <p style={{ color: "var(--text-muted)", marginBottom: "1.5rem", lineHeight: 1.6 }}>
                        Question Storming generates answers by challenging existing constraints.
                        Start with the contextual prompt or enter your own.
                    </p>

                    <div className="storm-input-group">
                        <textarea
                            className="storm-textarea textarea"
                            rows="3"
                            value={inputValue}
                            onChange={(e) => setInputValue(e.target.value)}
                            placeholder="Type a strategic question to storm..."
                            style={{ width: "100%", padding: "1rem", borderRadius: "8px", background: "rgba(0,0,0,0.2)", border: "1px solid var(--border-color)", color: "var(--text-main)", fontFamily: "var(--font-mono)", fontSize: "0.9rem", resize: "none" }}
                        />
                        <div style={{ display: "flex", justifyContent: "flex-end", marginTop: "1rem" }}>
                            <button className="storm-btn" onClick={handleStorm}>
                                <CloudLightning size={16} /> Storm Now
                            </button>
                        </div>
                    </div>

                    {storms.length > 0 && (
                        <div className="analyzer-result fade-in" style={{ marginTop: "3rem" }}>
                            <h4 style={{ color: "var(--accent-cyan)", marginBottom: "1.25rem", fontFamily: "var(--font-mono)", textTransform: "uppercase", fontSize: "0.85rem", letterSpacing: "0.05em" }}>Session History</h4>
                            <ul className="suggested-questions">
                                {storms.map((storm, idx) => (
                                    <li key={idx} style={{ borderLeft: "3px solid var(--accent-emerald)" }}>
                                        <div style={{ fontSize: "0.8rem", color: "var(--text-muted)", marginBottom: "0.5rem" }}>{storm.timestamp}</div>
                                        <div style={{ color: "var(--text-main)", fontWeight: 600, marginBottom: "0.5rem", fontSize: "1.05rem" }}>Q: {storm.question}</div>
                                        <div style={{ color: "var(--accent-emerald-glow)", lineHeight: 1.5 }}>A: {storm.answer}</div>
                                        <a href={storm.link} target="_blank" style={{ color: "var(--accent-cyan)", textDecoration: "none", fontSize: "0.85rem", marginTop: "0.5rem", marginBottom: "1rem", display: "inline-block", fontWeight: 600 }}>Explore Resource &rarr;</a>

                                        {storm.suggestedQuestion && (
                                            <div style={{ marginTop: "1rem", paddingTop: "1.25rem", borderTop: "1px dashed rgba(255,255,255,0.1)", width: "100%" }}>
                                                <div style={{ color: "var(--text-muted)", fontSize: "0.85rem", marginBottom: "0.5rem", textTransform: "uppercase", letterSpacing: "0.05em", fontFamily: "var(--font-mono)" }}>Suggested Next Storm</div>
                                                <div style={{ color: "var(--text-main)", fontWeight: 500, fontStyle: "italic", marginBottom: "1rem" }}>"{storm.suggestedQuestion}"</div>
                                                <button className="storm-btn" onClick={() => handleStorm(storm.suggestedQuestion)}>
                                                    <CloudLightning size={16} /> Storm This
                                                </button>
                                            </div>
                                        )}
                                    </li>
                                ))}
                            </ul>
                        </div>
                    )}
                </div>
            );
        };

        const D2Wayfinder = () => {
            return (
                <div className="analyzer-container fade-in" style={{ padding: 0, height: 'calc(100dvh - 120px)', border: '1px solid var(--border-color)', borderRadius: '12px', overflow: 'hidden' }}>
                    <iframe
                        src="./wayfinder.html?v=3"
                        style={{ width: '100%', height: '100%', border: 'none' }}
                        title="D2 Wayfinder Ecosystem Mapping"
                    />
                </div>
            );
        };

        const AppDrawer = () => {
            const { drawerOpen, closeDrawer, activeGlobalApp, activePage } = useContext(AppContext);
            const appData = NAVIGATION.GlobalApps.find(app => app.id === activeGlobalApp);

            return (
                <>
                    <div className={`drawer-overlay ${drawerOpen ? 'open' : ''}`} onClick={closeDrawer}></div>
                    <div className={`drawer ${drawerOpen ? 'open' : ''} ${activeGlobalApp === 'D2' ? 'maximized' : ''}`}>

                        {appData && (
                            <div className="drawer-header">
                                <div className="drawer-title-group">
                                    <h3 style={{ color: "var(--accent-cyan)" }}>
                                        {appData.label}
                                    </h3>
                                    {appData.id === 'D2' && (
                                        <div className="drawer-subtitle">
                                            "You donâ€™t pick the path because of the destination; you discover the destination because of the path."
                                        </div>
                                    )}
                                </div>
                                <button className="close-btn" onClick={closeDrawer}>
                                    <X size={20} />
                                </button>
                            </div>
                        )}

                        <div className="drawer-content">
                            {activeGlobalApp === "D4" ? (
                                <D4Analyzer />
                            ) : activeGlobalApp === "D3" ? (
                                <D3Survey />
                            ) : activeGlobalApp === "D1" ? (
                                <D1QuestionStormer />
                            ) : activeGlobalApp === "D2" ? (
                                <D2Wayfinder />
                            ) : appData ? (
                                <div className="system-card">
                                    <div className="system-card-header">
                                        <span>System Analytics</span>
                                        <span>Context Ready</span>
                                    </div>
                                    <p style={{ color: "var(--text-muted)", marginBottom: "1.5rem", fontSize: "0.95rem", lineHeight: 1.6 }}>
                                        This is a structural placeholder for the <b>{appData.label}</b> application shell.
                                        In Phase 2, this will load the functional app capable of deeply analyzing context.
                                    </p>

                                    <div className="code-block">
                                        {`{
  "request": "${appData.label.toUpperCase()}_INIT",
  "status": "AWAITING_PHASE_2",
  "injected_context": {
    "current_module": "${activePage}",
    "timestamp": "${new Date().toISOString()}"
  },
  "action": "RENDER_PLACEHOLDER"
}`}
                                    </div>

                                    <div className="status-badge" style={{ marginTop: "2rem", width: "100%", justifyContent: "center" }}>
                                        <span>Cross-Pollination Engine Standing By</span>
                                    </div>
                                </div>
                            ) : (
                                <div>Loading Context...</div>
                            )}
                        </div>
                    </div>
                </>
            );
        };

        // Represents pages A1-C6
        const PlaceholderView = ({ title, pillarName, description }) => {
            const { setActivePage } = useContext(AppContext);
            const location = useLocation();

            useEffect(() => {
                setActivePage(title);
            }, [title, setActivePage]);

            return (
                <div className="placeholder-card" key={location.pathname}>
                    <div className="glow-circle"></div>
                    <div className="placeholder-icon">
                        {getIconForPath(location.pathname)}
                    </div>
                    <h2 className="placeholder-title" style={{ marginBottom: "1rem" }}>{title}</h2>
                    {description && (
                        <p style={{ color: "var(--text-main)", fontSize: "1.05rem", lineHeight: 1.6, marginBottom: "1.5rem", maxWidth: "600px", marginInline: "auto" }}>
                            {description}
                        </p>
                    )}
                    <p className="placeholder-subtitle">
                        Architectural shell verified. This interface route is stabilized and reserved for Phase 2 functional development of the {pillarName} module.
                    </p>

                    <div className="context-badge" style={{ marginTop: "3rem", background: "transparent", border: "1px solid var(--border-active)" }}>
                        <span className="pulse-dot"></span>
                        Route Node Established
                    </div>
                </div>
            );
        };

        const A1ServiceDelivery = () => {
            const { setActivePage } = useContext(AppContext);

            useEffect(() => {
                setActivePage("A1 Service Delivery");
            }, [setActivePage]);

            const frameworks = [
                {
                    id: "purpose",
                    title: "Purpose & Mission",
                    icon: <Target size={24} />,
                    color: "var(--accent-emerald)",
                    description: "The fundamental 'Why'. This defines your organisation's core existence beyond just delivering services, providing a guiding north star.",
                    sectorContext: "A well-defined purpose aligns stakeholders, inspires volunteers, and sets crucial boundaries for what the charity will and will not do in a crowded ecosystem."
                },
                {
                    id: "toc",
                    title: "Theory of Change (TOC)",
                    icon: <Layers size={24} />,
                    color: "var(--accent-cyan)",
                    description: "The 'How'. A logical roadmap that illustrates how and why a desired change is expected to happen in a particular context.",
                    sectorContext: "TOC maps the causal links between Inputs, Activities, Outputs, Outcomes, and Impacts. It is essential for strategic planning and demonstrating social value to funders."
                },
                {
                    id: "sef",
                    title: "Sector Evaluation Framework (SEF)",
                    icon: <BarChart2 size={24} />,
                    color: "#f59e0b",
                    description: "The 'Measurement'. Developed by NCSS, SEF establishes a common language for measuring outcomes and impact across the social service sector.",
                    sectorContext: "It recommends standardised, validated outcome metrics for common programmes. It monitors Quality of Life (QOL) for service users, ensuring high-quality interventions and aiding landscape planning."
                },
                {
                    id: "impact",
                    title: "Social Impact",
                    icon: <Users size={24} />,
                    color: "var(--accent-purple)",
                    description: "The 'Result'. The ultimate, long-term, or systemic change brought about by the charity's interventions.",
                    sectorContext: "Impact involves moving beyond simply measuring 'activities done' (outputs) to understanding the sustained change in beneficiaries' lives or societal structures, driven by the TOC and measured via SEF."
                }
            ];

            return (
                <div className="fade-in" style={{ paddingBottom: "2rem", height: "100%", overflowY: "auto", paddingRight: "10px" }}>
                    <div style={{ marginBottom: "2.5rem" }}>
                        <h1 style={{ fontSize: "2.2rem", fontWeight: 800, marginBottom: "0.75rem", color: "var(--text-main)" }}>A1 Service Delivery</h1>
                        <p style={{ color: "var(--text-muted)", fontSize: "1.05rem", maxWidth: "800px", lineHeight: 1.6 }}>
                            Service Delivery is the heartbeat of a charity. To be effective, it must be anchored in four interrelated strategic foundations. Review the industry standard frameworks below to align your delivery model.
                        </p>
                    </div>

                    <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(min(100%, 280px), 1fr))", gap: "1.5rem" }}>
                        {frameworks.map((fw) => (
                            <div key={fw.id} style={{
                                background: "rgba(255,255,255,0.03)",
                                borderRadius: "16px",
                                border: "1px solid var(--border-color)",
                                borderTop: `4px solid ${fw.color}`,
                                padding: "1.5rem",
                                display: "flex",
                                flexDirection: "column",
                                gap: "1rem",
                                transition: "var(--transition-smooth)"
                            }} className="system-card">
                                <div style={{ display: "flex", alignItems: "center", gap: "1rem" }}>
                                    <div style={{ color: fw.color, background: "rgba(0,0,0,0.3)", padding: "0.75rem", borderRadius: "12px", border: "1px solid rgba(255,255,255,0.05)" }}>
                                        {fw.icon}
                                    </div>
                                    <h3 style={{ color: "var(--text-main)", fontSize: "1.2rem", fontWeight: 700 }}>
                                        {fw.title}
                                    </h3>
                                </div>
                                <p style={{ color: "var(--text-main)", fontSize: "0.95rem", lineHeight: 1.6, fontWeight: 500, minHeight: "80px" }}>
                                    {fw.description}
                                </p>
                                <div style={{
                                    background: "rgba(0,0,0,0.2)",
                                    padding: "1rem",
                                    borderRadius: "8px",
                                    borderLeft: `2px solid ${fw.color}`,
                                    marginTop: "auto"
                                }}>
                                    <h4 style={{ color: "var(--text-muted)", fontSize: "0.75rem", textTransform: "uppercase", letterSpacing: "0.05em", marginBottom: "0.5rem" }}>Sector Context</h4>
                                    <p style={{ color: "var(--text-muted)", fontSize: "0.85rem", lineHeight: 1.5 }}>
                                        {fw.sectorContext}
                                    </p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const A2Inputs = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => setActivePage("A2 Inputs"), []);
            return (
                <OutlineView
                    title="A2 Inputs"
                    desc="Inputs are the resources committed to your programme. Understand the capital required to run your operations effectively."
                    sections={[
                        { title: "Definitions of Key Terms", content: "Financial Capital: Cash, grants, and funding. Human Capital: Staff time, volunteer hours, and expertise. Physical Capital: Facilities, equipment, and infrastructure. Intellectual Capital: Proprietary programs, methodologies, and data." },
                        { title: "Best Practices & Useful Resources", content: "Meticulously track both direct and indirect costs. Quantify in-kind donations and volunteer time to represent the true cost of program delivery. Regularly audit resource utilization against strategic goals." }
                    ]}
                />
            );
        };

        const A3Outputs = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => setActivePage("A3 Outputs"), []);
            return (
                <OutlineView
                    title="A3 Outputs"
                    desc="Outputs are the direct, quantifiable products of your activities. Track the volume of work delivered."
                    sections={[
                        { title: "Definitions of Key Terms", content: "Outputs: Direct, quantifiable products or services delivered (e.g., number of beneficiaries served, training hours). Activities: The actions taken to deliver the outputs. Targets: Expected volume or frequency of service delivery." },
                        { title: "Best Practices & Useful Resources", content: "Keep output metrics distinct from outcomes; outputs measure volume, not change. Establish robust CRM and data collection mechanisms for real-time tracking. Ensure outputs directly map to intended activities in the Theory of Change." }
                    ]}
                />
            );
        };

        const A4Outcomes = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => setActivePage("A4 Outcomes"), []);
            return (
                <OutlineView
                    title="A4 Outcomes"
                    desc="Outcomes reflect the actual changes in your beneficiaries. Measure shifts in knowledge, behaviour, and condition."
                    sections={[
                        { title: "Definitions of Key Terms", content: "Outcomes: Changes in knowledge, behavior, condition, or status resulting from your activities. Baselines: The starting point before intervention. Indicators: Specific, measurable markers of change." },
                        { title: "Best Practices & Useful Resources", content: "Use standardized/validated measurement tools (like NCSS SEF, WHO-5, GAD-7) where possible. Focus on outcomes plausibly attributable to your intervention. Regularly assess baseline data before service delivery begins." }
                    ]}
                />
            );
        };

        const A5Impact = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => setActivePage("A5 Impact"), []);
            return (
                <OutlineView
                    title="A5 Impact"
                    desc="Impact is the ultimate, long-term, or systemic change brought about by your charity's interventions."
                    sections={[
                        { title: "Definitions of Key Terms", content: "Impact: Broad, long-term systemic or societal change. WELLBY: Wellbeing Adjusted Life Year, a measure of life satisfaction change. Attribution: The portion of the impact directly caused by your organization versus external elements." },
                        { title: "Best Practices & Useful Resources", content: "Conduct longitudinal studies to truly understand sustained impact. Avoid overclaiming attribution; acknowledge external environmental factors. Openly incorporate beneficiary voices and lived experiences into your reporting." }
                    ]}
                />
            );
        };

        const C1GEC = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => {
                setActivePage("C1 Governance Evaluation Checklist (GEC)");
            }, [setActivePage]);

            const [selectedTier, setSelectedTier] = useState(1);

            const principles = [
                { id: "p1", name: "Principle 1", desc: "The charity serves its mission and achieves its objectives." },
                { id: "p2", name: "Principle 2", desc: "The charity has an effective Board and Management." },
                { id: "p3", name: "Principle 3", desc: "The charity acts responsibly, fairly and with integrity." },
                { id: "p4", name: "Principle 4", desc: "The charity is well-managed and plans for the future." },
                { id: "p5", name: "Principle 5", desc: "The charity is accountable and transparent." },
                { id: "p6", name: "Principle 6", desc: "The charity communicates actively to instill public confidence." }
            ];

            const gecGuidelines = [
                // P1
                { id: "1.1", p: "p1", t1: true, t2: true, text: "Clearly state the charitable purposes (for example, vision and mission, objectives, use of resources, activities, and so on) and include the objectives in the charity's governing instrument. Publish the stated charitable purposes on platforms (for example, Charity Portal, website, social media channels, and so on) that can be easily accessed by the public." },
                { id: "1.2", p: "p1", t1: true, t2: true, text: "Develop and implement strategic plans to achieve the stated charitable purposes." },
                { id: "1.3", p: "p1", t1: true, t2: true, text: "Have the Board review the charity's strategic plans regularly to ensure that the charity is achieving its charitable purposes, and monitor, evaluate and report the outcome and impact of its activities." },
                { id: "1.4", p: "p1", t1: false, t2: true, text: "Ensure that the charity's activities are aligned with its charitable purposes on an ongoing basis." },
                // P2
                { id: "2.1", p: "p2", t1: true, t2: true, text: "The Board and Management are collectively responsible for achieving the charity's charitable purposes. The roles and responsibilities of the Board and Management should be clear and distinct." },
                { id: "2.2", p: "p2", t1: true, t2: true, text: "Document the terms of reference for the Board and its committees." },
                { id: "2.3", p: "p2", t1: true, t2: true, text: "Board members should serve a maximum of 10 consecutive years." },
                { id: "2.4", p: "p2", t1: true, t2: true, text: "At least two-thirds of the Board comprises independent members." },
                { id: "2.5", p: "p2", t1: true, t2: true, text: "Regular Board meetings are held, with a quorum of at least one-third." },
                { id: "2.6", p: "p2", t1: true, t2: true, text: "Board members receive no remuneration for their Board services." },
                { id: "2.7", p: "p2", t1: true, t2: true, text: "Conduct a regular self-evaluation to assess the Board's performance." },
                { id: "2.8", p: "p2", t1: true, t2: true, text: "Nominating Committee oversees selection and appointment of new Board members." },
                { id: "2.9", p: "p2", t1: false, t2: true, text: "Audit Committee oversees financial reporting and internal controls." },
                { id: "2.10", p: "p2", t1: false, t2: true, text: "Risk Management Committee identifies and mitigates organizational risks." },
                // P3
                { id: "3.1", p: "p3", t1: true, t2: true, text: "Document procedures for Board members and staff to declare actual or potential conflicts of interest." },
                { id: "3.2", p: "p3", t1: true, t2: true, text: "Conflicted parties abstain from decision-making and voting." },
                { id: "3.3", p: "p3", t1: true, t2: true, text: "Maintain a Code of Conduct for Board members, staff, and volunteers." },
                { id: "3.4", p: "p3", t1: true, t2: true, text: "Establish a whistle-blowing policy accessible to all stakeholders." },
                { id: "3.5", p: "p3", t1: true, t2: true, text: "Comply with the Personal Data Protection Act (PDPA)." },
                { id: "3.6", p: "p3", t1: true, t2: true, text: "Regularly review fundraising routines to maintain ethical standards." },
                // P4
                { id: "4.1", p: "p4", t1: true, t2: true, text: "Approve documented human resource policies for staff." },
                { id: "4.2", p: "p4", t1: true, t2: true, text: "Implement a performance appraisal system for all paid staff." },
                { id: "4.3", p: "p4", t1: true, t2: true, text: "Board approves annual budget and monitors expenditure." },
                { id: "4.4", p: "p4", t1: true, t2: true, text: "Ensure adequate internal controls over financial and operational processes." },
                { id: "4.5", p: "p4", t1: false, t2: true, text: "Documented investment policy if holding reserve funds." },
                { id: "4.6", p: "p4", t1: false, t2: true, text: "Review IT security policies to safeguard data." },
                { id: "4.7", p: "p4", t1: false, t2: true, text: "Business continuity plan (BCP) ensuring operational resilience." },
                // P5
                { id: "5.1", p: "p5", t1: true, t2: true, text: "Disclose top 3 highest-paid staff remuneration in bands of $100k." },
                { id: "5.2", p: "p5", t1: true, t2: true, text: "Disclose if staff members are close family members of Board Members." },
                { id: "5.3", p: "p5", t1: true, t2: true, text: "Donations in-kind are accurately recorded." },
                { id: "5.4", p: "p5", t1: true, t2: true, text: "Maintain documented reserves policy and disclose reserves level." },
                { id: "5.5", p: "p5", t1: true, t2: true, text: "Financial statements prepared according to Charities Accounting Standard." },
                { id: "5.6", p: "p5", t1: true, t2: true, text: "Clean external audit report." },
                { id: "5.7", p: "p5", t1: true, t2: true, text: "Submit Governance Evaluation Checklist (GEC) on time." },
                { id: "5.8", p: "p5", t1: false, t2: true, text: "Engage internal auditor to review internal controls." },
                // P6
                { id: "6.1", p: "p6", t1: true, t2: true, text: "Regularly update stakeholders on progress." },
                { id: "6.2", p: "p6", t1: true, t2: true, text: "Fundraising appeals clearly state purpose." },
                { id: "6.3", p: "p6", t1: false, t2: true, text: "Publish corporate communications policy." }
            ];

            const [answers, setAnswers] = useState({});
            const [explanations, setExplanations] = useState({});
            const [expandedPanels, setExpandedPanels] = useState({ p1: true });

            const togglePanel = (pId) => {
                setExpandedPanels(prev => ({ ...prev, [pId]: !prev[pId] }));
            };

            const handleSetAnswer = (id, val) => {
                setAnswers(prev => ({ ...prev, [id]: val }));
                if (val === 'Yes') {
                    // clear explanation if they change to yes
                    setExplanations(prev => ({ ...prev, [id]: '' }));
                }
            };

            const handleSetExplanation = (id, val) => {
                setExplanations(prev => ({ ...prev, [id]: val }));
            };

            // Active items calculation
            const activeItems = gecGuidelines.filter(item => selectedTier === 1 ? item.t1 : item.t2);
            const totalItems = activeItems.length;
            const completedItems = activeItems.filter(item => answers[item.id]).length;
            const percentage = Math.round((completedItems / totalItems) * 100) || 0;

            return (
                <div className="fade-in" style={{ paddingBottom: "2rem", height: "100%", overflowY: "auto", paddingRight: "10px" }}>
                    <div style={{ marginBottom: "2.5rem" }}>
                        <h1 style={{ fontSize: "2.2rem", fontWeight: 800, marginBottom: "0.75rem", color: "var(--text-main)", display: "flex", alignItems: "center", gap: "1rem" }}>
                            <Shield size={32} color="var(--accent-purple)" />
                            GOVERNANCE EVALUATION CHECKLIST (GEC)
                        </h1>
                        <p style={{ color: "var(--text-muted)", fontSize: "1.05rem", maxWidth: "800px", lineHeight: 1.6 }}>
                            A mandatory organizational self-evaluation simulating the official MSF submission. Check off requirements progressively below.
                        </p>
                    </div>

                    {/* Tier Selector */}
                    <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(280px, 1fr))", gap: "1.5rem", marginBottom: "2.5rem" }}>
                        <div
                            onClick={() => setSelectedTier(1)}
                            style={{
                                background: selectedTier === 1 ? "rgba(56, 189, 248, 0.15)" : "rgba(255,255,255,0.03)",
                                border: selectedTier === 1 ? "2px solid var(--accent-cyan)" : "1px solid var(--border-color)",
                                borderRadius: "12px",
                                padding: "1.5rem",
                                cursor: "pointer",
                                transition: "all 0.2s ease",
                                textAlign: "center"
                            }}
                        >
                            <div style={{ background: selectedTier === 1 ? "var(--accent-cyan)" : "rgba(255,255,255,0.1)", color: selectedTier === 1 ? "#000" : "white", display: "inline-block", padding: "0.4rem 1.5rem", borderRadius: "20px", fontWeight: "bold", marginBottom: "1rem", fontSize: "0.95rem" }}>TIER 1</div>
                            <h3 style={{ color: selectedTier === 1 ? "var(--accent-cyan)" : "var(--text-main)", fontSize: "1.1rem", marginBottom: "0.25rem" }}>Small and Medium</h3>
                            <p style={{ color: "var(--text-muted)", fontSize: "0.95rem", margin: 0 }}>Non-IPC Charities</p>
                        </div>

                        <div
                            onClick={() => setSelectedTier(2)}
                            style={{
                                background: selectedTier === 2 ? "rgba(56, 189, 248, 0.15)" : "rgba(255,255,255,0.03)",
                                border: selectedTier === 2 ? "2px solid var(--accent-cyan)" : "1px solid var(--border-color)",
                                borderRadius: "12px",
                                padding: "1.5rem",
                                cursor: "pointer",
                                transition: "all 0.2s ease",
                                textAlign: "center"
                            }}
                        >
                            <div style={{ background: selectedTier === 2 ? "var(--accent-cyan)" : "rgba(255,255,255,0.1)", color: selectedTier === 2 ? "#000" : "white", display: "inline-block", padding: "0.4rem 1.5rem", borderRadius: "20px", fontWeight: "bold", marginBottom: "1rem", fontSize: "0.95rem" }}>TIER 2</div>
                            <h3 style={{ color: selectedTier === 2 ? "var(--accent-cyan)" : "var(--text-main)", fontSize: "1.1rem", marginBottom: "0.25rem" }}>(i) All IPCs</h3>
                            <p style={{ color: "var(--text-muted)", fontSize: "0.95rem", margin: 0 }}>(ii) Large Non-IPC Charities</p>
                        </div>
                    </div>

                    {/* Progress Gauge */}
                    <div style={{ background: "rgba(0,0,0,0.2)", borderRadius: "12px", padding: "1.5rem", marginBottom: "2.5rem", display: "flex", alignItems: "center", justifyContent: "space-between", flexWrap: "wrap", gap: "1.5rem", border: "1px solid rgba(56, 189, 248, 0.3)" }}>
                        <div>
                            <h2 style={{ color: "var(--accent-cyan)", margin: 0, fontSize: "1.4rem" }}>Submission Readiness: Tier {selectedTier}</h2>
                            <p style={{ color: "var(--text-muted)", margin: "0.5rem 0 0 0", fontSize: "0.95rem" }}>Complete all questions before submitting the final checklist.</p>
                        </div>
                        <div style={{ textAlign: "right" }}>
                            <div style={{ fontSize: "2.8rem", fontWeight: "800", color: percentage === 100 ? "var(--accent-emerald)" : "var(--accent-cyan)", fontFamily: "var(--font-mono)", lineHeight: 1 }}>
                                {percentage}%
                            </div>
                            <div style={{ color: "var(--text-muted)", fontSize: "0.95rem", marginTop: "0.25rem" }}>{completedItems} of {totalItems} Requirements Addressed</div>
                        </div>
                    </div>

                    {/* Full Checklist Base - Styled to mimic the PDF rendering closely */}
                    <div style={{ display: "flex", flexDirection: "column", gap: "2.5rem", background: "white", padding: "2rem", borderRadius: "12px" }}>
                        {principles.map(p => {
                            const items = gecGuidelines.filter(i => i.p === p.id && (selectedTier === 1 ? i.t1 : i.t2));
                            if (items.length === 0) return null;

                            return (
                                <div key={p.id} style={{ borderRadius: "16px", overflow: "hidden", border: "4px solid #1c4b69", boxShadow: "0 8px 30px rgba(0,0,0,0.15)" }}>

                                    {/* Principle Header (White Background, Document match) */}
                                    <div
                                        onClick={() => togglePanel(p.id)}
                                        style={{ background: "#ffffff", padding: "1.5rem", textAlign: "center", borderBottom: expandedPanels[p.id] ? "4px solid #1c4b69" : "none", cursor: "pointer", display: "flex", justifyContent: "space-between", alignItems: "center" }}
                                    >
                                        <div style={{ width: "24px" }}></div> {/* spacer */}
                                        <div style={{ flex: 1 }}>
                                            <h3 style={{ color: "#1c4b69", fontSize: "1.1rem", margin: "0 0 0.25rem 0", fontWeight: "bold" }}>{p.name}:</h3>
                                            <p style={{ color: "#333", margin: 0, fontSize: "0.95rem" }}>{p.desc}</p>
                                        </div>
                                        <div style={{ width: "24px", color: "#1c4b69", fontWeight: "bold", fontSize: "1.5rem", display: "flex", alignItems: "center", justifyContent: "center" }}>
                                            {expandedPanels[p.id] ? "âˆ’" : "+"}
                                        </div>
                                    </div>

                                    {/* Table Container */}
                                    {expandedPanels[p.id] && (
                                        <div style={{ background: "#1c4b69", overflowX: "auto" }}>
                                            <table style={{ width: "100%", borderCollapse: "collapse", color: "white", minWidth: "700px" }}>
                                                <thead>
                                                    <tr style={{ borderBottom: "2px solid #0f2c40", fontSize: "0.85rem", textTransform: "uppercase" }}>
                                                        <th style={{ padding: "1.2rem", textAlign: "center", width: "40%" }}>Call for Action</th>
                                                        <th style={{ padding: "1.2rem", textAlign: "center", borderLeft: "2px solid #0f2c40", width: "10%" }}>Code ID</th>
                                                        <th style={{ padding: "1.2rem", textAlign: "center", borderLeft: "2px solid #0f2c40", width: "25%" }}>Did the charity put this principle into action?</th>
                                                        <th style={{ padding: "1.2rem", textAlign: "center", borderLeft: "2px solid #0f2c40", width: "25%" }}>If you have indicated "No" or "Partial Compliance", please explain.</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {items.map((item, idx) => (
                                                        <tr key={item.id} style={{ borderBottom: idx < items.length - 1 ? "2px solid #1c4b69" : "none", background: "white", color: "#333" }}>

                                                            {/* 1. Call for Action */}
                                                            <td style={{ padding: "1.25rem 1.5rem", fontSize: "0.95rem", lineHeight: 1.6, verticalAlign: "top" }}>
                                                                <div style={{ display: "flex", gap: "0.75rem" }}>
                                                                    <span style={{ fontWeight: "bold" }}>{idx + 1}.</span>
                                                                    <span>{item.text}</span>
                                                                </div>
                                                            </td>

                                                            {/* 2. Code ID */}
                                                            <td style={{ padding: "1.25rem 1rem", textAlign: "center", borderLeft: "2px solid #1c4b69", verticalAlign: "top", fontWeight: "bold", fontSize: "1.1rem", color: "#1c4b69" }}>
                                                                {item.id}
                                                            </td>

                                                            {/* 3. Radio Options */}
                                                            <td style={{ padding: "1.25rem 1rem", borderLeft: "2px solid #1c4b69", verticalAlign: "top", fontSize: "0.9rem", color: "#333" }}>
                                                                <div style={{ display: "flex", flexDirection: "column", gap: "0.75rem", paddingLeft: "1rem" }}>
                                                                    <label style={{ display: "flex", alignItems: "center", gap: "0.5rem", cursor: "pointer", fontWeight: answers[item.id] === 'Yes' ? "bold" : "normal" }}>
                                                                        <input type="radio" name={`q-${item.id}`} value="Yes" checked={answers[item.id] === 'Yes'} onChange={() => handleSetAnswer(item.id, 'Yes')} style={{ accentColor: "#1c4b69", width: "16px", height: "16px" }} /> Yes
                                                                    </label>
                                                                    <label style={{ display: "flex", alignItems: "center", gap: "0.5rem", cursor: "pointer", fontWeight: answers[item.id] === 'No' ? "bold" : "normal" }}>
                                                                        <input type="radio" name={`q-${item.id}`} value="No" checked={answers[item.id] === 'No'} onChange={() => handleSetAnswer(item.id, 'No')} style={{ accentColor: "#1c4b69", width: "16px", height: "16px" }} /> No
                                                                    </label>
                                                                    <label style={{ display: "flex", alignItems: "center", gap: "0.5rem", cursor: "pointer", fontWeight: answers[item.id] === 'Partial Compliance' ? "bold" : "normal" }}>
                                                                        <input type="radio" name={`q-${item.id}`} value="Partial Compliance" checked={answers[item.id] === 'Partial Compliance'} onChange={() => handleSetAnswer(item.id, 'Partial Compliance')} style={{ accentColor: "#1c4b69", width: "16px", height: "16px" }} /> Partial Compliance
                                                                    </label>
                                                                </div>
                                                            </td>

                                                            {/* 4. Explanation */}
                                                            <td style={{ padding: "1.25rem 1rem", borderLeft: "2px solid #1c4b69", verticalAlign: "top" }}>
                                                                <textarea
                                                                    placeholder={answers[item.id] === 'No' || answers[item.id] === 'Partial Compliance' ? "Type your explanation here..." : "Explanation required if No or Partial."}
                                                                    value={explanations[item.id] || ''}
                                                                    onChange={(e) => handleSetExplanation(item.id, e.target.value)}
                                                                    disabled={answers[item.id] === 'Yes' || !answers[item.id]}
                                                                    style={{
                                                                        width: "100%", height: "90px", padding: "0.75rem", borderRadius: "8px", border: "1px solid #cbd5e1", resize: "none",
                                                                        fontFamily: "inherit", fontSize: "0.9rem", color: "#333",
                                                                        background: (answers[item.id] === 'Yes' || !answers[item.id]) ? "#f1f5f9" : "#fff",
                                                                        opacity: (answers[item.id] === 'Yes' || !answers[item.id]) ? 0.6 : 1,
                                                                        cursor: (answers[item.id] === 'Yes' || !answers[item.id]) ? "not-allowed" : "text",
                                                                        outlineColor: "#1c4b69"
                                                                    }}
                                                                />
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const C2RiskManagement = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => setActivePage("C2 Risk Management"), []);
            return (
                <OutlineView
                    title="C2 Risk Management"
                    desc="Identify, assess, and mitigate risks. Build resilience by tracking operational, financial, and reputational risks to protect the charity's mission."
                    sections={[
                        { title: "Definitions of Key Terms", content: "Risk Register: A central dashboard tracking identified risks and their likelihood. Mitigation Strategies: Tactics designed to reduce the severity or probability of a risk. Critical Incidents: Unforeseen events requiring immediate crisis response." },
                        { title: "Best Practices & Useful Resources", content: "Conduct routine risk assessments across all functional departments. Ensure whistle-blowing policies are accessible and transparent to all stakeholders. Link severe risks directly to board-level oversight." }
                    ]}
                />
            );
        };

        const OutlineView = ({ title, desc, sections }) => (
            <div className="fade-in" style={{ paddingBottom: "2rem", height: "100%", overflowY: "auto", paddingRight: "10px" }}>
                <div style={{ marginBottom: "2.5rem" }}>
                    <h1 style={{ fontSize: "2.2rem", fontWeight: 800, marginBottom: "0.75rem", color: "var(--text-main)", display: "flex", alignItems: "center", gap: "1rem" }}>
                        <ClipboardList size={32} color="var(--accent-cyan)" />
                        {title}
                    </h1>
                    <p style={{ color: "var(--text-muted)", fontSize: "1.05rem", maxWidth: "800px", lineHeight: 1.6 }}>
                        {desc}
                    </p>
                </div>

                <div style={{ background: "rgba(255,255,255,0.03)", borderRadius: "12px", border: "1px solid var(--border-color)", overflow: "hidden" }}>
                    <div style={{ background: "rgba(0,0,0,0.3)", padding: "1rem 1.5rem", borderBottom: "1px solid var(--border-color)" }}>
                        <h3 style={{ color: "var(--accent-cyan)", fontSize: "1.1rem", fontWeight: 600 }}>Key Concepts & Resources</h3>
                    </div>
                    <div style={{ padding: "1.5rem", display: "flex", flexDirection: "column", gap: "1rem" }}>
                        {sections.map((section, idx) => (
                            <div key={idx} style={{
                                display: "flex",
                                gap: "1rem",
                                alignItems: "flex-start",
                                paddingBottom: "1rem",
                                borderBottom: idx < sections.length - 1 ? "1px dashed rgba(255,255,255,0.1)" : "none"
                            }}>
                                <div style={{
                                    minWidth: "30px",
                                    height: "30px",
                                    background: "rgba(6, 182, 212, 0.1)",
                                    color: "var(--accent-cyan)",
                                    borderRadius: "50%",
                                    display: "flex",
                                    alignItems: "center",
                                    justifyContent: "center",
                                    fontSize: "0.9rem",
                                    fontWeight: "bold"
                                }}>
                                    {idx + 1}
                                </div>
                                <div style={{ flex: 1 }}>
                                    <h4 style={{ color: "var(--text-main)", fontSize: "1.05rem", marginBottom: "0.25rem" }}>{section.title}</h4>
                                    <p style={{ color: "var(--text-muted)", fontSize: "0.9rem", lineHeight: 1.5 }}>{section.content}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        );

        const C3SOP = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => setActivePage("C3 SOP"), []);
            return (
                <OutlineView
                    title="C3 Standard Operating Procedures"
                    desc="Standardize internal processes. A central repository of operational guidelines to ensure consistency and mitigate risks."
                    sections={[
                        { title: "Definitions of Key Terms", content: "SOP (Standard Operating Procedure): Documented step-by-step instructions. Procurement Workflows: Rules governing purchasing. Internal Controls: Mechanisms to prevent fraud and errors." },
                        { title: "Best Practices & Useful Resources", content: "Keep SOPs consistently updated to reflect actual operational realities. Distinguish clearly between guidelines (flexible) and procedures (mandatory). Train all staff on critical compliance workflows." }
                    ]}
                />
            );
        };

        const C4Constitution = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => setActivePage("C4 Constitution"), []);
            return (
                <OutlineView
                    title="C4 Constitution"
                    desc="Manage the foundation of your charity. Track updates to the governing instrument."
                    sections={[
                        { title: "Definitions of Key Terms", content: "Objects: The primary purpose and specific charitable activities authorized. Quorum: Minimum number of members required to conduct business. General Meetings: AGM or EGM instances." },
                        { title: "Best Practices & Useful Resources", content: "Regularly review the constitution to ensure alignment with current societal needs. Ensure absolute compliance with term limits and board composition rules set by the Charity Council." }
                    ]}
                />
            );
        };

        const C5TOR = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => setActivePage("C5 Terms of Reference"), []);
            return (
                <OutlineView
                    title="C5 Terms of Reference (TOR)"
                    desc="Define committee scopes. Manage the roles, responsibilities, and authority limits of sub-committees."
                    sections={[
                        { title: "Definitions of Key Terms", content: "Mandate: The committee's core purpose. Scope of Authority: Distinction between advisory capacity and decision-making power. Composition: Required skill sets and member numbers." },
                        { title: "Best Practices & Useful Resources", content: "Explicitly distinguish between an advisory capacity and decision-making power. Review TORs annually to prevent scope creep. Ensure committee members have the requisite skill sets." }
                    ]}
                />
            );
        };

        const C6StrategicPlan = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => setActivePage("C6 Strategic Plans"), []);
            return (
                <OutlineView
                    title="C6 Strategic Plans"
                    desc="Chart the long-term course. Document multi-year strategic goals, align resources, and track progress."
                    sections={[
                        { title: "Definitions of Key Terms", content: "Environmental Scan (SWOT): Analysis of Strengths, Weaknesses, Opportunities, Threats. Roadmap: Phased timeline detailing initiatives. KPIs: Key Performance Indicators tracking success." },
                        { title: "Best Practices & Useful Resources", content: "Anchor strategic goals squarely in the Theory of Change. Conduct inclusive planning sessions with staff, board, and beneficiaries. Link strategic objectives directly to budget allocations." }
                    ]}
                />
            );
        };

        const B1Finance = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => setActivePage("B1: Financial Sustainability"), []);

            // Sliders
            const [cashOnHand, setCashOnHand] = useState(500000);
            const [expectedIn, setExpectedIn] = useState(250000);
            const [expectedOut, setExpectedOut] = useState(200000);

            // Drill down states
            const [showCashDetails, setShowCashDetails] = useState(false);
            const [showInDetails, setShowInDetails] = useState(false);
            const [showOutDetails, setShowOutDetails] = useState(false);

            // Breakdown values
            const [cashDetails, setCashDetails] = useState([{ id: 'main', label: 'Main Account', value: 450000 }, { id: 'fixed', label: 'Fixed Deposit', value: 48000 }, { id: 'petty', label: 'Petty Cash', value: 2000 }]);
            const [inDetails, setInDetails] = useState([{ id: 'ncss', label: 'NCSS Grants', value: 150000 }, { id: 'donors', label: 'Individual Donors', value: 50000 }, { id: 'foundations', label: 'Foundations', value: 50000 }]);
            const [outDetails, setOutDetails] = useState([{ id: 'salary', label: 'Staff Salaries', value: 120000 }, { id: 'rent', label: 'Rental', value: 60000 }, { id: 'utils', label: 'Utilities/Admin', value: 20000 }]);

            useEffect(() => {
                if (showCashDetails) setCashOnHand(cashDetails.reduce((a, b) => a + Number(b.value), 0));
            }, [cashDetails, showCashDetails]);

            useEffect(() => {
                if (showInDetails) setExpectedIn(inDetails.reduce((a, b) => a + Number(b.value), 0));
            }, [inDetails, showInDetails]);

            useEffect(() => {
                if (showOutDetails) setExpectedOut(outDetails.reduce((a, b) => a + Number(b.value), 0));
            }, [outDetails, showOutDetails]);

            const formatCurrency = (val) => new Intl.NumberFormat('en-SG', { style: 'currency', currency: 'SGD', maximumFractionDigits: 0 }).format(val);

            const netPosition = (cashOnHand + expectedIn) - expectedOut;
            const isSafe = netPosition >= Math.max(0, cashOnHand * 0.5);
            const isDanger = netPosition < 0;

            let fuelColor = "var(--accent-cyan)";
            if (isDanger) fuelColor = "var(--accent-red, #f43f5e)";
            else if (isSafe) fuelColor = "var(--accent-emerald)";
            else fuelColor = "#f59e0b"; // Warning

            const baseTotalForPercentage = cashOnHand + expectedIn;
            const fuelPercentage = baseTotalForPercentage > 0 ? Math.max(0, Math.min(100, (netPosition / baseTotalForPercentage) * 100)) : 0;

            return (
                <div className="analyzer-container fade-in" style={{ padding: "1.5rem", maxWidth: "800px", margin: "0 auto", paddingBottom: "4rem" }}>
                    <div style={{ marginBottom: "2rem" }}>
                        <h2 style={{ color: "var(--accent-cyan)", marginBottom: "0.5rem", fontSize: "1.8rem", display: "flex", alignItems: "center", gap: "0.5rem" }}>
                            <Layers size={24} color="#38bdf8" /> B1: Financial Sustainability
                        </h2>
                        <p style={{ color: "var(--text-muted)", fontSize: "1.05rem", lineHeight: "1.6" }}>
                            What's in the tank? How much is being pumped in? How fast is it leaking out?<br />
                            <span style={{ color: "var(--text-main)" }}>Guesstimate first, Detail later.</span>
                        </p>
                    </div>

                    <div style={{ display: "grid", gap: "1.5rem", marginBottom: "2.5rem" }}>
                        {/* SLIDER 1 */}
                        <div style={{ background: "rgba(255,255,255,0.03)", padding: "1.5rem", borderRadius: "12px", border: "1px solid rgba(56, 189, 248, 0.3)" }}>
                            <div style={{ display: "flex", justifyContent: "space-between", marginBottom: "1rem", flexWrap: "wrap", gap: "0.5rem" }}>
                                <span style={{ fontSize: "1.1rem", fontWeight: "600", color: "#38bdf8" }}>Current Cash on Hand</span>
                                <span style={{ fontSize: "1.1rem", color: "white", fontFamily: "var(--font-mono)" }}>{formatCurrency(cashOnHand)}</span>
                            </div>
                            <input
                                type="range" min="0" max="2000000" step="10000"
                                value={cashOnHand}
                                onChange={(e) => !showCashDetails && setCashOnHand(Number(e.target.value))}
                                disabled={showCashDetails}
                                style={{ width: "100%", accentColor: "#38bdf8", cursor: showCashDetails ? "not-allowed" : "pointer", height: "6px", opacity: showCashDetails ? 0.6 : 1 }}
                            />

                            <button onClick={() => setShowCashDetails(!showCashDetails)} style={{ background: "none", border: "none", color: "var(--text-muted)", marginTop: "1rem", cursor: "pointer", fontSize: "0.85rem", display: "flex", alignItems: "center", gap: "0.3rem", padding: "0" }}>
                                {showCashDetails ? <ChevronDown size={14} /> : <ChevronRight size={14} />}
                                {showCashDetails ? "Use Master Slider instead" : "Wait, let me be more specific..."}
                            </button>
                            {showCashDetails && (
                                <div style={{ marginTop: "1rem", display: "grid", gap: "0.75rem", padding: "1rem", background: "rgba(0,0,0,0.2)", borderRadius: "8px" }}>
                                    {cashDetails.map((item, idx) => (
                                        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", flexWrap: "wrap", gap: "0.5rem" }} key={item.id}>
                                            <input type="text" value={item.label} onChange={(e) => { const newArr = [...cashDetails]; newArr[idx].label = e.target.value; setCashDetails(newArr); }} style={{ color: "var(--text-muted)", fontSize: "0.9rem", background: "transparent", border: "1px dashed transparent", outline: "none", width: "160px", borderBottom: "1px dashed rgba(255,255,255,0.2)", transition: "border 0.2s" }} onFocus={(e) => e.target.style.borderBottom = "1px solid var(--accent-cyan)"} onBlur={(e) => e.target.style.borderBottom = "1px dashed rgba(255,255,255,0.2)"} />
                                            <div style={{ display: "flex", alignItems: "center", gap: "0.5rem" }}>
                                                <span style={{ color: "var(--text-muted)" }}>S$</span>
                                                <input type="number" min="0" value={item.value || ""} onChange={(e) => { const newArr = [...cashDetails]; newArr[idx].value = Number(e.target.value); setCashDetails(newArr); }} style={{ background: "rgba(255,255,255,0.05)", border: "1px solid var(--border-color)", color: "white", padding: "6px 10px", borderRadius: "6px", width: "120px", outline: "none", fontFamily: "var(--font-mono)" }} />
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        {/* SLIDER 2 */}
                        <div style={{ background: "rgba(255,255,255,0.03)", padding: "1.5rem", borderRadius: "12px", border: "1px solid rgba(16, 185, 129, 0.3)" }}>
                            <div style={{ display: "flex", justifyContent: "space-between", marginBottom: "1rem", flexWrap: "wrap", gap: "0.5rem" }}>
                                <span style={{ fontSize: "1.1rem", fontWeight: "600", color: "#10b981" }}>Expected Money In <span style={{ fontSize: "0.8rem", color: "var(--text-muted)", fontWeight: "normal" }}>(Next 6 Months)</span></span>
                                <span style={{ fontSize: "1.1rem", color: "white", fontFamily: "var(--font-mono)" }}>{formatCurrency(expectedIn)}</span>
                            </div>
                            <input
                                type="range" min="0" max="1000000" step="5000"
                                value={expectedIn}
                                onChange={(e) => !showInDetails && setExpectedIn(Number(e.target.value))}
                                disabled={showInDetails}
                                style={{ width: "100%", accentColor: "#10b981", cursor: showInDetails ? "not-allowed" : "pointer", height: "6px", opacity: showInDetails ? 0.6 : 1 }}
                            />

                            <button onClick={() => setShowInDetails(!showInDetails)} style={{ background: "none", border: "none", color: "var(--text-muted)", marginTop: "1rem", cursor: "pointer", fontSize: "0.85rem", display: "flex", alignItems: "center", gap: "0.3rem", padding: "0" }}>
                                {showInDetails ? <ChevronDown size={14} /> : <ChevronRight size={14} />}
                                {showInDetails ? "Use Master Slider instead" : "Wait, let me be more specific..."}
                            </button>
                            {showInDetails && (
                                <div style={{ marginTop: "1rem", display: "grid", gap: "0.75rem", padding: "1rem", background: "rgba(0,0,0,0.2)", borderRadius: "8px" }}>
                                    {inDetails.map((item, idx) => (
                                        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", flexWrap: "wrap", gap: "0.5rem" }} key={item.id}>
                                            <input type="text" value={item.label} onChange={(e) => { const newArr = [...inDetails]; newArr[idx].label = e.target.value; setInDetails(newArr); }} style={{ color: "var(--text-muted)", fontSize: "0.9rem", background: "transparent", border: "1px dashed transparent", outline: "none", width: "160px", borderBottom: "1px dashed rgba(255,255,255,0.2)", transition: "border 0.2s" }} onFocus={(e) => e.target.style.borderBottom = "1px solid var(--accent-cyan)"} onBlur={(e) => e.target.style.borderBottom = "1px dashed rgba(255,255,255,0.2)"} />
                                            <div style={{ display: "flex", alignItems: "center", gap: "0.5rem" }}>
                                                <span style={{ color: "var(--text-muted)" }}>S$</span>
                                                <input type="number" min="0" value={item.value || ""} onChange={(e) => { const newArr = [...inDetails]; newArr[idx].value = Number(e.target.value); setInDetails(newArr); }} style={{ background: "rgba(255,255,255,0.05)", border: "1px solid var(--border-color)", color: "white", padding: "6px 10px", borderRadius: "6px", width: "120px", outline: "none", fontFamily: "var(--font-mono)" }} />
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        {/* SLIDER 3 */}
                        <div style={{ background: "rgba(255,255,255,0.03)", padding: "1.5rem", borderRadius: "12px", border: "1px solid rgba(244, 63, 94, 0.3)" }}>
                            <div style={{ display: "flex", justifyContent: "space-between", marginBottom: "1rem", flexWrap: "wrap", gap: "0.5rem" }}>
                                <span style={{ fontSize: "1.1rem", fontWeight: "600", color: "#f43f5e" }}>Expected Money Out <span style={{ fontSize: "0.8rem", color: "var(--text-muted)", fontWeight: "normal" }}>(Next 6 Months)</span></span>
                                <span style={{ fontSize: "1.1rem", color: "white", fontFamily: "var(--font-mono)" }}>{formatCurrency(expectedOut)}</span>
                            </div>
                            <input
                                type="range" min="0" max="1000000" step="5000"
                                value={expectedOut}
                                onChange={(e) => !showOutDetails && setExpectedOut(Number(e.target.value))}
                                disabled={showOutDetails}
                                style={{ width: "100%", accentColor: "#f43f5e", cursor: showOutDetails ? "not-allowed" : "pointer", height: "6px", opacity: showOutDetails ? 0.6 : 1 }}
                            />

                            <button onClick={() => setShowOutDetails(!showOutDetails)} style={{ background: "none", border: "none", color: "var(--text-muted)", marginTop: "1rem", cursor: "pointer", fontSize: "0.85rem", display: "flex", alignItems: "center", gap: "0.3rem", padding: "0" }}>
                                {showOutDetails ? <ChevronDown size={14} /> : <ChevronRight size={14} />}
                                {showOutDetails ? "Use Master Slider instead" : "Wait, let me be more specific..."}
                            </button>
                            {showOutDetails && (
                                <div style={{ marginTop: "1rem", display: "grid", gap: "0.75rem", padding: "1rem", background: "rgba(0,0,0,0.2)", borderRadius: "8px" }}>
                                    {outDetails.map((item, idx) => (
                                        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", flexWrap: "wrap", gap: "0.5rem" }} key={item.id}>
                                            <input type="text" value={item.label} onChange={(e) => { const newArr = [...outDetails]; newArr[idx].label = e.target.value; setOutDetails(newArr); }} style={{ color: "var(--text-muted)", fontSize: "0.9rem", background: "transparent", border: "1px dashed transparent", outline: "none", width: "160px", borderBottom: "1px dashed rgba(255,255,255,0.2)", transition: "border 0.2s" }} onFocus={(e) => e.target.style.borderBottom = "1px solid var(--accent-cyan)"} onBlur={(e) => e.target.style.borderBottom = "1px dashed rgba(255,255,255,0.2)"} />
                                            <div style={{ display: "flex", alignItems: "center", gap: "0.5rem" }}>
                                                <span style={{ color: "var(--text-muted)" }}>S$</span>
                                                <input type="number" min="0" value={item.value || ""} onChange={(e) => { const newArr = [...outDetails]; newArr[idx].value = Number(e.target.value); setOutDetails(newArr); }} style={{ background: "rgba(255,255,255,0.05)", border: "1px solid var(--border-color)", color: "white", padding: "6px 10px", borderRadius: "6px", width: "120px", outline: "none", fontFamily: "var(--font-mono)" }} />
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* DASHBOARD RESULT */}
                    <div style={{ background: "rgba(255,255,255,0.02)", padding: "2rem", borderRadius: "16px", border: "1px solid var(--border-color)", textAlign: "center", marginBottom: "2rem" }}>
                        <h3 style={{ color: "var(--text-muted)", marginBottom: "1rem", textTransform: "uppercase", letterSpacing: "1px", fontSize: "0.85rem" }}>6-Month Projected Fuel Gauge<br /><span style={{ fontSize: "0.7rem", opacity: 0.6 }}>(Assumes no additional top-ups beyond "Money In")</span></h3>
                        <div style={{ fontSize: "2.5rem", fontWeight: "bold", color: fuelColor, marginBottom: "1rem", textShadow: `0 0 20px ${fuelColor}40`, fontFamily: "var(--font-mono)" }}>
                            {formatCurrency(netPosition)}
                        </div>

                        <div style={{ width: "100%", height: "20px", background: "rgba(255,255,255,0.05)", borderRadius: "10px", overflow: "hidden", position: "relative", border: "1px solid rgba(255,255,255,0.1)" }}>
                            <div style={{
                                position: "absolute", left: 0, top: 0, bottom: 0,
                                width: `${fuelPercentage}%`,
                                background: fuelColor, transition: "all 0.5s cubic-bezier(0.4, 0, 0.2, 1)",
                                boxShadow: "inset 0 1px 1px rgba(255,255,255,0.3)"
                            }}></div>
                        </div>
                        <div style={{ display: "flex", justifyContent: "space-between", marginTop: "0.75rem", color: "var(--text-muted)", fontSize: "0.8rem", textTransform: "uppercase" }}>
                            <span style={{ color: "var(--accent-red)", opacity: 0.8 }}>Empty (Deficit)</span>
                            <span style={{ color: "var(--accent-emerald)", opacity: 0.8 }}>Full (Surplus)</span>
                        </div>
                    </div>

                    {/* ACTIVE INQUIRY */}
                    {expectedOut > expectedIn && (
                        <div className="fade-in" style={{ background: "linear-gradient(to right, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05))", borderLeft: "4px solid #f59e0b", padding: "1.5rem", borderRadius: "8px" }}>
                            <strong style={{ display: "flex", alignItems: "center", gap: "0.5rem", color: "#f59e0b", marginBottom: "0.75rem", fontSize: "1.1rem" }}>
                                <AlertTriangle size={18} /> Ask the Treasurer this:
                            </strong>
                            <div style={{ fontSize: "1.05rem", color: "var(--text-main)", fontStyle: "italic", lineHeight: "1.6" }}>
                                "We are projecting to spend more than we earn over the next 6 months. Is this a planned one-time operational deficit using our reserves, or are we looking at a permanent structural trend?"
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const B2FundRaising = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => setActivePage("B2 Fund Raising"), []);
            return (
                <OutlineView
                    title="B2 Fund Raising"
                    desc="Cultivate donor relationships and manage fundraising campaigns. Track donor retention and campaign ROI."
                    sections={[
                        { title: "Definitions of Key Terms", content: "Donor Retention: Percentage of donors who give repeatedly. Campaign ROI: Return on investment for fundraising efforts. IPC Status: Institution of a Public Character allowing tax-deductible donations." },
                        { title: "Best Practices & Useful Resources", content: "Tailor campaigns to specific donor personas using CRM tools. Comply meticulously with the House to House and Street Collections Act. Cultivate long-term stewardship over one-off transactions." }
                    ]}
                />
            );
        };

        const B3Volunteer = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => setActivePage("B3 Volunteer Management"), []);
            return (
                <OutlineView
                    title="B3 Volunteer Management"
                    desc="Attract, retain, and develop volunteers. Manage recruitment, training, scheduling, and impact."
                    sections={[
                        { title: "Definitions of Key Terms", content: "Screening: Background and reference checks to ensure beneficiary safety. Onboarding: Structural orientation to the charity's mission. Retention: Strategies to keep volunteers engaged over time." },
                        { title: "Best Practices & Useful Resources", content: "Implement rigorous safeguarding and screening protocols. Treat volunteers as unpaid staff with structured performance feedback and appreciation. Provide clear, documented role descriptions." }
                    ]}
                />
            );
        };

        const B4Marketing = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => setActivePage("B4 Marketing & Communications"), []);
            return (
                <OutlineView
                    title="B4 Marketing & Communications"
                    desc="Amplify your charity's voice. Manage public relations, social media, campaign reach, and brand reputation."
                    sections={[
                        { title: "Definitions of Key Terms", content: "Brand Identity: Visual assets and official tone of voice. Crisis Communication: Rapid-response planning for reputational threats. Impact Reporting: Articulating program success to the public." },
                        { title: "Best Practices & Useful Resources", content: "Maintain a unified brand voice across digital and print channels. Pre-plan crisis communication protocols. Highlight beneficiary stories ethically and with explicit consent." }
                    ]}
                />
            );
        };

        const B5HR = () => {
            const { setActivePage } = useContext(AppContext);
            useEffect(() => setActivePage("B5 Human Resource"), []);
            return (
                <OutlineView
                    title="B5 Human Resource"
                    desc="Build a strong team. Manage staff recruitment, retention, professional development, well-being, and compliance."
                    sections={[
                        { title: "Definitions of Key Terms", content: "Compensation Banding: Structured salary ranges for organization parity. KPIs: Key Performance Indicators for staff goals. Wellbeing: Proactive physical and mental health support mechanisms." },
                        { title: "Best Practices & Useful Resources", content: "Implement standardized, unbiased hiring practices to promote equity. Drive appraisal cycles using measurable data. Invest deliberately in staff training pathways to reduce turnover." }
                    ]}
                />
            );
        };

        const NewsFeed = () => {
            const defaultNews = [
                {
                    source: "Straits Times",
                    time: "3 hours ago",
                    title: "Charities to get more help with leadership renewal, evaluating their practices",
                    category: "Governance",
                    url: "https://www.straitstimes.com/singapore/charities-to-get-more-help-with-leadership-renewal-evaluating-their-practices"
                },
                {
                    source: "Statutes Online",
                    time: "5 hours ago",
                    title: "Charities Act 1994",
                    category: "Compliance",
                    url: "https://sso.agc.gov.sg/Act/CA1994"
                },
                {
                    source: "NCSS Tech-and-GO",
                    time: "1 day ago",
                    title: "Tech-and-GO Funding Extended",
                    category: "Digitalization",
                    url: "https://www.ncss.gov.sg/our-initiatives/tech-and-go"
                },
                {
                    source: "President's Challenge",
                    time: "2 days ago",
                    title: "President's Challenge shifts gear to focus on fostering sustained social impact",
                    category: "Funding",
                    url: "https://www.presidentschallenge.gov.sg/about-us"
                }
            ];

            const [newsItems, setNewsItems] = useState(defaultNews);
            const [isSyncing, setIsSyncing] = useState(false);
            const [lastSynced, setLastSynced] = useState(new Date());

            const fetchNews = async () => {
                setIsSyncing(true);
                try {
                    // Use a public RSS to JSON service to pull latest Google News results for Singapore Charities
                    const rssUrl = encodeURIComponent("https://news.google.com/rss/search?q=singapore+charity+governance&hl=en-SG&gl=SG&ceid=SG:en");
                    const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${rssUrl}`);

                    if (response.ok) {
                        const data = await response.json();
                        if (data.status === 'ok' && data.items && data.items.length > 0) {
                            const freshItems = data.items.slice(0, 4).map((item, index) => {
                                const pubDate = new Date(item.pubDate);
                                const now = new Date();
                                const diffHours = Math.floor((now - pubDate) / (1000 * 60 * 60));
                                let timeString = diffHours < 1 ? "Just now" : `${diffHours} hour${diffHours === 1 ? '' : 's'} ago`;
                                if (diffHours >= 24) {
                                    const diffDays = Math.floor(diffHours / 24);
                                    timeString = `${diffDays} day${diffDays === 1 ? '' : 's'} ago`;
                                }

                                // Google News format: "Actual Title - Source Name"
                                const titleParts = item.title.split(' - ');
                                const source = titleParts.length > 1 ? titleParts.pop() : "Sector News";
                                const cleanTitle = titleParts.join(' - ');

                                const categories = ["Governance", "Compliance", "Digitalization", "Funding"];

                                return {
                                    source: source.length > 20 ? source.substring(0, 20) + "..." : source,
                                    time: timeString,
                                    title: cleanTitle.length > 65 ? cleanTitle.substring(0, 65) + "..." : cleanTitle,
                                    category: categories[index % categories.length],
                                    url: item.link
                                };
                            });
                            setNewsItems(freshItems.length > 0 ? freshItems : defaultNews);
                            setLastSynced(new Date());
                        }
                    }
                } catch (error) {
                    console.error("Live feed sync failed, defaulting to curated feed.");
                    // Gracefully falls back to defaultNews if API is down or rate limited
                } finally {
                    setIsSyncing(false);
                }
            };

            useEffect(() => {
                fetchNews();
                // Pull for latest news every 4 hours
                const intervalId = setInterval(fetchNews, 4 * 60 * 60 * 1000);
                return () => clearInterval(intervalId);
            }, []);

            return (
                <div style={{
                    background: "rgba(255,255,255,0.03)",
                    border: "1px solid var(--border-color)",
                    borderRadius: "12px",
                    padding: "1.5rem",
                    display: "flex",
                    flexDirection: "column",
                    gap: "1rem",
                    height: "100%",
                }}>
                    <style>
                        {`
                        .news-card {
                            display: block;
                            padding: 1.2rem;
                            background: rgba(255,255,255,0.02);
                            border-radius: 8px;
                            border-left: 3px solid var(--accent-cyan);
                            transition: all 0.2s ease-in-out;
                            text-decoration: none;
                            cursor: pointer;
                        }
                        .news-card:hover {
                            background: rgba(255,255,255,0.06) !important;
                            transform: translateX(4px);
                            border-left: 3px solid var(--accent-emerald);
                        }
                        
                        @keyframes pulse {
                            0% { opacity: 0.5; }
                            50% { opacity: 1; }
                            100% { opacity: 0.5; }
                        }
                        .syncing-dot {
                            animation: pulse 1.5s infinite;
                            display: inline-block;
                        }
                        `}
                    </style>
                    <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: "0.5rem" }}>
                        <h3 style={{ color: "var(--text-main)", display: "flex", alignItems: "center", gap: "0.5rem", fontSize: "1.1rem", margin: 0 }}>
                            <Activity size={18} color="var(--accent-purple)" />
                            Sector News Feed
                        </h3>
                        <div style={{ fontSize: "0.7rem", color: "var(--text-muted)", display: "flex", alignItems: "center", gap: "0.3rem" }}>
                            {isSyncing ? (
                                <><span title="Pulling latest data..." className="syncing-dot" style={{ color: "var(--accent-cyan)" }}>â—</span> Syncing...</>
                            ) : (
                                <><span title="Live Feed Connected" style={{ color: "var(--accent-emerald)" }}>â—</span> Auto-updates (4h)</>
                            )}
                        </div>
                    </div>
                    <div style={{ display: "flex", flexDirection: "column", gap: "1rem", overflowY: "auto", flexGrow: 1 }} className="scrollbar-hide">
                        {newsItems.map((item, idx) => (
                            <a
                                key={idx}
                                href={item.url}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="news-card"
                            >
                                <div style={{ display: "flex", justifyContent: "space-between", fontSize: "0.75rem", color: "var(--text-muted)", marginBottom: "0.5rem" }}>
                                    <span>{item.source}</span>
                                    <span>{item.time}</span>
                                </div>
                                <h4 style={{ fontSize: "0.95rem", color: "var(--text-main)", marginBottom: "0.5rem", lineHeight: 1.4, fontWeight: "500" }}>{item.title}</h4>
                                <span style={{
                                    display: "inline-block",
                                    padding: "0.2rem 0.5rem",
                                    borderRadius: "4px",
                                    background: "rgba(255,255,255,0.05)",
                                    fontSize: "0.7rem",
                                    color: "var(--text-muted)",
                                    textTransform: "uppercase",
                                    letterSpacing: "0.05em"
                                }}>
                                    {item.category}
                                </span>
                            </a>
                        ))}
                    </div>
                </div>
            );
        };

        const DashboardHome = () => {
            const { setActivePage, openApp } = useContext(AppContext);

            useEffect(() => {
                setActivePage("Global Overview");
            }, [setActivePage]);

            const cardStyle = {
                background: "rgba(255,255,255,0.03)",
                padding: "1.5rem",
                borderRadius: "12px",
                border: "1px solid var(--border-color)",
                cursor: "pointer",
                transition: "var(--transition-smooth)",
                height: "100%"
            };

            return (
                <div className="hero-welcome">
                    <style>
                        {`
                        .hover-card:hover {
                            background: rgba(255,255,255,0.06) !important;
                            transform: translateY(-3px);
                            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
                        }
                        `}
                    </style>
                    <div className="context-badge" style={{ marginBottom: "2rem" }}>
                        System Online
                    </div>
                    <h1>
                        Welcome to <br />
                        <span>GovernUp 2026</span>
                    </h1>

                    <div style={{ marginBottom: "3rem" }}>
                        <button
                            onClick={() => {
                                const modal = document.createElement('div');
                                modal.className = 'modal-overlay fade-in';
                                modal.style.position = 'fixed';
                                modal.style.top = '0';
                                modal.style.left = '0';
                                modal.style.width = '100vw';
                                modal.style.height = '100vh';
                                modal.style.background = 'rgba(0, 0, 0, 0.8)';
                                modal.style.zIndex = '9999';
                                modal.style.display = 'flex';
                                modal.style.alignItems = 'center';
                                modal.style.justifyContent = 'center';
                                modal.style.padding = '2rem';

                                const content = document.createElement('div');
                                content.className = 'modal-content';
                                content.style.background = 'var(--bg-panel)';
                                content.style.border = '1px solid var(--border-color)';
                                content.style.borderRadius = '12px';
                                content.style.padding = '2rem';
                                content.style.maxWidth = '800px';
                                content.style.width = '100%';
                                content.style.maxHeight = '90vh';
                                content.style.overflowY = 'auto';
                                content.style.position = 'relative';

                                const closeBtn = document.createElement('button');
                                closeBtn.innerHTML = 'âœ•';
                                closeBtn.style.position = 'absolute';
                                closeBtn.style.top = '1rem';
                                closeBtn.style.right = '1rem';
                                closeBtn.style.background = 'none';
                                closeBtn.style.border = 'none';
                                closeBtn.style.color = 'var(--text-muted)';
                                closeBtn.style.fontSize = '1.2rem';
                                closeBtn.style.cursor = 'pointer';
                                closeBtn.onclick = () => document.body.removeChild(modal);

                                content.innerHTML = `
                                    <h2 style="color: var(--accent-cyan); margin-bottom: 1.5rem; font-size: 1.8rem;">About GovernUp 2026</h2>
                                    <div style="color: var(--text-main); font-size: 1.05rem; line-height: 1.7;">
                                        <p style="margin-bottom: 1.5rem; font-size: 1.1rem; color: #fff;">
                                            GovernUp 2026 is like having a Chief Operating Officer sitting in the boardroom with you. It doesn't just tell you what the policies are; it actively helps you challenge assumptions, visualize the environment, and confidently plan for the future.
                                        </p>
                                        
                                        <p style="margin-bottom: 1rem;">
                                            The platform organizes everything a charity does into three simple, logical buckets so leaders can easily manage the big picture:
                                        </p>
                                        
                                        <ul style="list-style-type: none; padding-left: 0; margin-bottom: 1.5rem;">
                                            <li style="margin-bottom: 0.75rem; padding-left: 1.5rem; position: relative;">
                                                <span style="color: var(--accent-emerald); position: absolute; left: 0; font-weight: bold;">A.</span>
                                                <strong>Purpose & Mission:</strong> Why do we exist? (Focuses on the charity's goals, vision, and social impact).
                                            </li>
                                            <li style="margin-bottom: 0.75rem; padding-left: 1.5rem; position: relative;">
                                                <span style="color: var(--accent-cyan); position: absolute; left: 0; font-weight: bold;">B.</span>
                                                <strong>Operations:</strong> How do we run things? (Focuses on the day-to-day management of staff, volunteers, fundraising, and programs).
                                            </li>
                                            <li style="margin-bottom: 0.75rem; padding-left: 1.5rem; position: relative;">
                                                <span style="color: var(--accent-purple); position: absolute; left: 0; font-weight: bold;">C.</span>
                                                <strong>Governance:</strong> How do we stay safe? (Focuses on compliance, strict rules, audits, and board oversight).
                                            </li>
                                        </ul>
                                        
                                        <div style="background: rgba(255, 255, 255, 0.03); padding: 1.25rem; border-radius: 8px; border-left: 4px solid #f59e0b;">
                                            <strong style="color: #f59e0b; display: block; margin-bottom: 0.5rem; font-size: 1.1rem;">The New "Smart Tools"</strong>
                                            The biggest upgrades in the 2026 version are the interactive tools (the D-Series) visible on the dashboard. These act like a digital consulting team built right into the software to help boards solve complex problems.
                                        </div>
                                        
                                        <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                                            <h3 style="color: var(--text-main); font-size: 1.2rem; margin-bottom: 1rem;">Subscription Plans</h3>
                                            <p style="margin-bottom: 1rem;">GovernUp 2026 is available in 3 flavours:</p>
                                            <ul style="list-style-type: none; padding-left: 0; margin-bottom: 0;">
                                                <li style="margin-bottom: 0.75rem; padding-left: 1.5rem; position: relative;">
                                                    <span style="color: var(--accent-cyan); position: absolute; left: 0;">â€¢</span>
                                                    <strong>Standard (S$100/month):</strong> Includes all C Governance modules and D Smart Tools modules.
                                                </li>
                                                <li style="margin-bottom: 0.75rem; padding-left: 1.5rem; position: relative;">
                                                    <span style="color: var(--accent-emerald); position: absolute; left: 0;">â€¢</span>
                                                    <strong>Plus (S$1,500/month):</strong> Includes A1, B1, C, and D modules.
                                                </li>
                                                <li style="margin-bottom: 0; padding-left: 1.5rem; position: relative;">
                                                    <span style="color: var(--accent-purple); position: absolute; left: 0;">â€¢</span>
                                                    <strong>Premium (S$2,500/month):</strong> Includes A, B, C, and D modules.
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                `;

                                content.appendChild(closeBtn);
                                modal.appendChild(content);

                                // Close on outside click
                                modal.onclick = (e) => {
                                    if (e.target === modal) document.body.removeChild(modal);
                                };

                                document.body.appendChild(modal);
                            }}
                            className="dock-btn text-dock-btn"
                            style={{ display: "inline-flex", alignItems: "center", gap: "0.5rem", padding: "0.75rem 1.5rem", background: "rgba(6, 182, 212, 0.1)", border: "1px solid rgba(6, 182, 212, 0.3)", borderRadius: "8px", color: "var(--accent-cyan)", fontWeight: "600", cursor: "pointer", fontSize: "1rem" }}
                        >
                            <Layers size={18} />
                            About GovernUp
                        </button>
                    </div>

                    <div style={{ display: "flex", gap: "2rem", flexWrap: "wrap", alignItems: "stretch", width: "100%", maxWidth: "1400px" }}>
                        <div style={{ flex: "1 1 min(100%, 700px)", display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(min(100%, 280px), 1fr))", gap: "1.5rem" }}>
                            <div className="hover-card" style={{ ...cardStyle, borderTop: "3px solid var(--accent-emerald)" }} onClick={() => openApp('D1')}>
                                <h3 style={{ color: "var(--text-main)", marginBottom: "0.5rem", display: "flex", alignItems: "center", gap: "0.5rem", fontSize: "1.1rem" }}>
                                    <span style={{ color: "var(--accent-emerald)", fontFamily: "var(--font-mono)" }}>D1</span> Question Stormer
                                </h3>
                                <p style={{ fontSize: "0.9rem", color: "var(--text-muted)", lineHeight: 1.6 }}>Challenge your assumptions. Start with context-aware prompts in any domain and let the engine fire back counter-intuitive follow-ups to break mental blocks before you lock in a strategy.</p>
                            </div>

                            <div className="hover-card" style={{ ...cardStyle, borderTop: "3px solid var(--accent-cyan)" }} onClick={() => openApp('D2')}>
                                <h3 style={{ color: "var(--text-main)", marginBottom: "0.5rem", display: "flex", alignItems: "center", gap: "0.5rem", fontSize: "1.1rem" }}>
                                    <span style={{ color: "var(--accent-cyan)", fontFamily: "var(--font-mono)" }}>D2</span> Wayfinder
                                </h3>
                                <p style={{ fontSize: "0.9rem", color: "var(--text-muted)", lineHeight: 1.6 }}>Visualize the broader ecosystem. This interactive force-directed map connects you to governing bodies, cross-sector stakeholders, and critical regulations to safely navigate the charity sector.</p>
                            </div>

                            <div className="hover-card" style={{ ...cardStyle, borderTop: "3px solid #f59e0b" }} onClick={() => openApp('D3')}>
                                <h3 style={{ color: "var(--text-main)", marginBottom: "0.5rem", display: "flex", alignItems: "center", gap: "0.5rem", fontSize: "1.1rem" }}>
                                    <span style={{ color: "#f59e0b", fontFamily: "var(--font-mono)" }}>D3</span> Survey
                                </h3>
                                <p style={{ fontSize: "0.9rem", color: "var(--text-muted)", lineHeight: 1.6 }}>Take the pulse of your stakeholders. Automatically generate 6-question targeted surveys for any specific pillar and instantly dispatch them via WhatsApp. You can even WhatsApp yourself as reminders!</p>
                            </div>

                            <div className="hover-card" style={{ ...cardStyle, borderTop: "3px solid var(--accent-purple)" }} onClick={() => openApp('D4')}>
                                <h3 style={{ color: "var(--text-main)", marginBottom: "0.5rem", display: "flex", alignItems: "center", gap: "0.5rem", fontSize: "1.1rem" }}>
                                    <span style={{ color: "var(--accent-purple)", fontFamily: "var(--font-mono)" }}>D4</span> Analyzer
                                </h3>
                                <p style={{ fontSize: "0.9rem", color: "var(--text-muted)", lineHeight: 1.6 }}>Synthesize the noise. Cross-pollinate inputs from multiple silos (e.g., HR + Finance + Strategy) to auto-generate unique prompts that uncover hidden thematic vulnerabilities and opportunities.</p>
                            </div>
                        </div>

                        <div style={{ flex: "1 1 300px", minWidth: "300px", maxWidth: "450px" }}>
                            <NewsFeed />
                        </div>
                    </div>
                </div>
            );
        };

        // Main Layout
        const Layout = () => {
            const { mobileMenuOpen, setMobileMenuOpen } = useContext(AppContext);

            return (
                <div className="app-container">
                    <div className={`mobile-overlay ${mobileMenuOpen ? 'open' : ''}`} onClick={() => setMobileMenuOpen(false)}></div>
                    <div className={`sidebar-container ${mobileMenuOpen ? 'open' : ''}`}>
                        <Sidebar />
                    </div>
                    <main className="main-wrapper">
                        <TopBar />
                        <div className="content-area">
                            <Routes>
                                <Route path="/" element={<DashboardHome />} />
                                {NAVIGATION.Pillars.flatMap(pillar =>
                                    pillar.items.map(item => (
                                        <Route
                                            key={item.id}
                                            path={item.path}
                                            element={
                                                item.id === "A1" ? <A1ServiceDelivery /> :
                                                    item.id === "A2" ? <A2Inputs /> :
                                                        item.id === "A3" ? <A3Outputs /> :
                                                            item.id === "A4" ? <A4Outcomes /> :
                                                                item.id === "A5" ? <A5Impact /> :
                                                                    item.id === "B1" ? <B1Finance /> :
                                                                        item.id === "B2" ? <B2FundRaising /> :
                                                                            item.id === "B3" ? <B3Volunteer /> :
                                                                                item.id === "B4" ? <B4Marketing /> :
                                                                                    item.id === "B5" ? <B5HR /> :
                                                                                        item.id === "C1" ? <C1GEC /> :
                                                                                            item.id === "C2" ? <C2RiskManagement /> :
                                                                                                item.id === "C3" ? <C3SOP /> :
                                                                                                    item.id === "C4" ? <C4Constitution /> :
                                                                                                        item.id === "C5" ? <C5TOR /> :
                                                                                                            item.id === "C6" ? <C6StrategicPlan /> :
                                                                                                                <PlaceholderView title={item.label} pillarName={pillar.title} description={item.description} />
                                            }
                                        />
                                    ))
                                )}
                            </Routes>
                        </div>
                        <AppDrawer />
                    </main>
                </div>
            );
        };

        const App = () => (
            <AppProvider>
                <HashRouter>
                    <Layout />
                </HashRouter>
            </AppProvider>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>

</html>